import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-I0A9ubIc.js";import{_ as y,u as i,p as D,c as E,w as o,o as d,b as s,d as l,e as a,a as u,r as t,f as _}from"./app-8GwUP-ei.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-vNnBn6C7.js";import"./YunCard.vue_vue_type_script_setup_true_lang-p8VTz71d.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-cTRbDIkO.js";import"./index-nlSmcLJj.js";const A="/assets/fastapi-jwt_03-22-11-28-26-_Z41ywjx.webp",sl=JSON.parse('{"title":"JWT 认证及其在 FastAPI 中的使用","description":"","frontmatter":{"title":"JWT 认证及其在 FastAPI 中的使用","date":"2023-03-22T10:59:53.000Z","updated":"2023-03-22T10:59:53.000Z","tags":["Python","代码","FastAPi"],"categories":["小技术"]},"headers":[{"level":2,"title":"什么是 JWT","slug":"什么是-jwt","link":"#什么是-jwt","children":[{"level":3,"title":"JWT 有什么用","slug":"jwt-有什么用","link":"#jwt-有什么用","children":[]}]},{"level":2,"title":"FastAPI 实现 Bearer JWT 令牌验证","slug":"fastapi-实现-bearer-jwt-令牌验证","link":"#fastapi-实现-bearer-jwt-令牌验证","children":[{"level":3,"title":"数据库与模型","slug":"数据库与模型","link":"#数据库与模型","children":[]},{"level":3,"title":"对用户名和密码的校验与认证","slug":"对用户名和密码的校验与认证","link":"#对用户名和密码的校验与认证","children":[]},{"level":3,"title":"创建 jwt token","slug":"创建-jwt-token","link":"#创建-jwt-token","children":[]},{"level":3,"title":"提供登录并创建token的接口","slug":"提供登录并创建token的接口","link":"#提供登录并创建token的接口","children":[]},{"level":3,"title":"在其他接口中验证jwt token","slug":"在其他接口中验证jwt-token","link":"#在其他接口中验证jwt-token","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"pages/posts/fastapi-jwt/index.md","path":"/home/runner/work/blog-source-valaxy/blog-source-valaxy/pages/posts/fastapi-jwt/index.md","lastUpdated":1702864755000}'),c=JSON.parse('{"title":"JWT 认证及其在 FastAPI 中的使用","description":"","frontmatter":{"title":"JWT 认证及其在 FastAPI 中的使用","date":"2023-03-22T10:59:53.000Z","updated":"2023-03-22T10:59:53.000Z","tags":["Python","代码","FastAPi"],"categories":["小技术"]},"headers":[{"level":2,"title":"什么是 JWT","slug":"什么是-jwt","link":"#什么是-jwt","children":[{"level":3,"title":"JWT 有什么用","slug":"jwt-有什么用","link":"#jwt-有什么用","children":[]}]},{"level":2,"title":"FastAPI 实现 Bearer JWT 令牌验证","slug":"fastapi-实现-bearer-jwt-令牌验证","link":"#fastapi-实现-bearer-jwt-令牌验证","children":[{"level":3,"title":"数据库与模型","slug":"数据库与模型","link":"#数据库与模型","children":[]},{"level":3,"title":"对用户名和密码的校验与认证","slug":"对用户名和密码的校验与认证","link":"#对用户名和密码的校验与认证","children":[]},{"level":3,"title":"创建 jwt token","slug":"创建-jwt-token","link":"#创建-jwt-token","children":[]},{"level":3,"title":"提供登录并创建token的接口","slug":"提供登录并创建token的接口","link":"#提供登录并创建token的接口","children":[]},{"level":3,"title":"在其他接口中验证jwt token","slug":"在其他接口中验证jwt-token","link":"#在其他接口中验证jwt-token","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"pages/posts/fastapi-jwt/index.md","path":"/home/runner/work/blog-source-valaxy/blog-source-valaxy/pages/posts/fastapi-jwt/index.md","lastUpdated":1702864755000}'),h={name:"pages/posts/fastapi-jwt/index.md",data(){return{data:c,frontmatter:c.frontmatter,$frontmatter:c.frontmatter}},setup(){const e=i();e.meta.frontmatter=Object.assign(e.meta.frontmatter,c.frontmatter),D("pageData",c)}},f={id:"什么是-jwt",tabindex:"-1"},C=s("p",null,"JWT: JSON Web Tokens,它是一种将 JSON 对象编码为没有空格，且难以理解的长字符串的标准。在具体上,它就是一段字符串,下面就是 FastAPI 文档中给出的例子",-1),m=s("div",{class:"language-txt"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"txt"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#24292e"}},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c")])])]),s("button",{class:"collapse"})],-1),k=s("p",null,"抽象地把它看成是这样的",-1),g=s("div",{class:"language-txt"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"txt"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"aaaaaaaaaaaa.bbbbbbbbbbbb.cccccccccccc")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#24292e"}},"aaaaaaaaaaaa.bbbbbbbbbbbb.cccccccccccc")])])]),s("button",{class:"collapse"})],-1),b=s("p",null,[l("jwt 由三个部分组成,这三个部分之间用点"),s("code",null,"."),l("拼接起来,这三个部分分别是")],-1),w=s("ul",null,[s("li",null,"Header --- 头,定义了 jwt 使用的算法等信息"),s("li",null,"Payload --- 载荷,存储有效信息的地方"),s("li",null,"Signature --- 签名,用于校验 jwt 令牌")],-1),T=s("p",null,"这三个部分中,只有第三个部分是无法还原的,前两个部分只是简单的进行了 base64 编码,把上面例子中的前两部分解码之后,看起来是这样的:",-1),j=s("p",null,"Header:",-1),v=s("div",{class:"language-json"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"json"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C792EA"}},"alg"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"HS256"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C792EA"}},"typ"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"JWT"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#005CC5"}},'"alg"'),s("span",{style:{color:"#24292E"}},":"),s("span",{style:{color:"#032F62"}},'"HS256"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#005CC5"}},'"typ"'),s("span",{style:{color:"#24292E"}},":"),s("span",{style:{color:"#032F62"}},'"JWT"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"}")])])]),s("button",{class:"collapse"})],-1),B=s("p",null,"alg 即为算法,这里使用了 HS256 算法",-1),x=s("p",null,"typ 即为类型,指明这里是一个 JWT 字符串",-1),I=s("p",null,"Payload",-1),P=s("div",{class:"language-json"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"json"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C792EA"}},"sub"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"1234567890"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C792EA"}},"name"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"John Doe"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C792EA"}},"iat"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"1516239022")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#005CC5"}},'"sub"'),s("span",{style:{color:"#24292E"}},":"),s("span",{style:{color:"#032F62"}},'"1234567890"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#005CC5"}},'"name"'),s("span",{style:{color:"#24292E"}},":"),s("span",{style:{color:"#032F62"}},'"John Doe"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#005CC5"}},'"iat"'),s("span",{style:{color:"#24292E"}},":"),s("span",{style:{color:"#005CC5"}},"1516239022")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"}")])])]),s("button",{class:"collapse"})],-1),U=s("p",null,"可以看到 Payload 中存储了主要的信息",-1),W=s("div",{class:"tip custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"提示"),s("span",{lang:"zh-CN"},"提示")]),s("p",null,[l("根据 JWT 规范, Payload 中的 "),s("code",null,"sub"),l(" 是一个预定义的声明（Claim），表示JWT的主题（"),s("strong",null,"Subject"),l("）。它指定了JWT所代表的实体或主题，通常是用户或客户端应用程序。 "),s("code",null,"sub"),l("声明的值是字符串类型，通常是"),s("strong",null,"唯一"),l("标识用户或客户端应用程序的ID。")])],-1),J=s("p",null,"而 Signature 则是通过加盐加密得到的,加密由服务端实现",-1),N=s("div",{class:"tip custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"关于具体如何实现"),s("span",{lang:"zh-CN"},"关于具体如何实现")]),s("p",null,"参考下图"),s("figure",null,[s("img",{src:A,alt:"图 1",loading:"lazy",decoding:"async"})]),s("p",null,[l("即,把 header 和 payload 部分进行 base64编码,用点拼接起来,得到"),s("strong",null,"结果"),l(",把这个结果用我们设置的密钥和算法进行加盐加密,就得到了 Signature")])],-1),S={id:"jwt-有什么用",tabindex:"-1"},O=s("p",null,"其实它与 token ,cookie 的作用类似,就是用来免密码认证客户端",-1),R=s("p",null,"比如你去上学,学校是服务端,你是客户端.你完成学籍注册之后,学校发给你一个学生证,学生证就是你的 jwt 令牌.",-1),M=s("p",null,"你使用学校的很多服务,都要出示学生证.",-1),H=s("p",null,"而在实际业务中,jwt 令牌是有过期时间的,过期之后,需要客户端再次登录,获取新的 jwt",-1),K={id:"fastapi-实现-bearer-jwt-令牌验证",tabindex:"-1"},$=s("p",null,"需要安装以下几个包",-1),G=s("p",null,"python-jose，在 Python 中生成和校验 JWT 令牌",-1),Y=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"pip"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"install"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"python-jose[cryptography]")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"pip"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"install"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"python-jose[cryptography]")])])]),s("button",{class:"collapse"})],-1),Z=s("p",null,"Passlib ,处理密码哈希",-1),L=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"pip"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"install"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"passlib[bcrypt]")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"pip"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"install"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"passlib[bcrypt]")])])]),s("button",{class:"collapse"})],-1),V=s("div",{class:"warning custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"WARNING"),s("span",{lang:"zh-CN"},"注意")]),s("p",null,"密码哈希和 jwt 的加密不是同一个问题."),s("p",null,"哈希是指把特定内容（本例中为密码）转换为乱码形式的字节序列（其实就是字符串）。"),s("p",null,"每次传入完全相同的内容时（比如，完全相同的密码），返回的都是完全相同的乱码。"),s("p",null,"但这个乱码无法转换回传入的密码。"),s("p",null,"把密码进行哈希并存储是必要的安全措施")],-1),X=s("p",null,"先不考虑用户注册的问题,假设我们已经有了一个在数据库中的用户,那么这里的逻辑是这样的:",-1),z=s("ol",null,[s("li",null,"该用户通过用户名和密码登录"),s("li",null,"服务端对其进行校验和认证"),s("li",null,"完成认证后,用户拿到 jwt 令牌(token)"),s("li",null,"用户使用 jwt 令牌(token)访问其他服务")],-1),Q=s("p",null,"所以,我们需要:",-1),q=s("ol",null,[s("li",null,"一个存储了用户信息的数据库,其中密码存储的是哈希值"),s("li",null,"用户和 jwt 令牌(token)的模型"),s("li",null,"用于从数据库中获得用户信息,并验证的函数. 包括获取用户,哈希传入的密码,验证用户等"),s("li",null,"用于创建 jwt 令牌的函数"),s("li",null,"给用户登录并获取 jwt 令牌(token)的接口"),s("li",null,"验证用户的 jwt 是否正确和有效")],-1),ss={id:"数据库与模型",tabindex:"-1"},ls=s("p",null,"呃,为了简便和偷懒,就用 FastAPI 文档中的假数据库吧",-1),os=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"fake_users_db "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"johndoe"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"username"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"johndoe"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"full_name"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"John Doe"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"email"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"johndoe@example.com"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"hashed_password"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"disabled"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"False,")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"fake_users_db "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"johndoe"'),s("span",{style:{color:"#24292E"}},": {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#032F62"}},'"username"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"johndoe"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#032F62"}},'"full_name"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"John Doe"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#032F62"}},'"email"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"johndoe@example.com"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#032F62"}},'"hashed_password"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#032F62"}},'"disabled"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#005CC5"}},"False"),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"}")])])]),s("button",{class:"collapse"})],-1),es=s("p",null,"定义之后要用到的模型",-1),ns=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," pydantic "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," BaseModel")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," typing "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," Union")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"class"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"Token"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#FFCB6B"}},"BaseModel"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    access_token"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    token_type"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"class"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"TokenData"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#FFCB6B"}},"BaseModel"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," Union"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None]"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"class"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"User"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#FFCB6B"}},"BaseModel"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    email"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," Union"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None]"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    full_name"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," Union"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None]"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    disabled"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," Union"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#FFCB6B"}},"bool"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None]"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"class"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"UserInDB"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#FFCB6B"}},"User"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    hashed_password"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," pydantic "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," BaseModel")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," typing "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," Union")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"class"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"Token"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#6F42C1"}},"BaseModel"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    access_token: "),s("span",{style:{color:"#005CC5"}},"str")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    token_type: "),s("span",{style:{color:"#005CC5"}},"str")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"class"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"TokenData"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#6F42C1"}},"BaseModel"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    username: Union["),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},"] "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"None")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"class"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"User"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#6F42C1"}},"BaseModel"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    username: "),s("span",{style:{color:"#005CC5"}},"str")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    email: Union["),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},"] "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"None")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    full_name: Union["),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},"] "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"None")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    disabled: Union["),s("span",{style:{color:"#005CC5"}},"bool"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},"] "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"None")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"class"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"UserInDB"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#6F42C1"}},"User"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    hashed_password: "),s("span",{style:{color:"#005CC5"}},"str")])])]),s("button",{class:"collapse"})],-1),as=s("p",null,[s("code",null,"Token"),l(" 模型用于在登录接口中指定 "),s("code",null,"response_model")],-1),ts=s("p",null,[s("code",null,"TokenData"),l(" 用于从 token 中获取数据")],-1),cs=s("p",null,[s("code",null,"User"),l(" 即用户模型,供外部使用")],-1),Fs=s("p",null,[s("code",null,"UserInDB"),l(" 是用户在数据库中的模型,它继承自 "),s("code",null,"User"),l(" 添加了 "),s("code",null,"hashed_password"),l(" 属性")],-1),rs=s("p",null,"这些模型在之后会用到",-1),ps={id:"对用户名和密码的校验与认证",tabindex:"-1"},ys=s("p",null,"这部分比较简单,就是把用户输入的密码哈希之后和数据库中的对比就好了",-1),is=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," passlib"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"context "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," CryptContext")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"pwd_context "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"CryptContext"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"schemes"),s("span",{style:{color:"#89DDFF"}},"=["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"bcrypt"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"],"),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"deprecated"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"auto"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"verify_password"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"plain_password"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"hashed_password"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#545454","font-style":"italic"}},"    校验密码是否正确")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#545454","font-style":"italic"}},"    将传入的明文密码与数据库中的哈希值进行比对")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#545454","font-style":"italic"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," pwd_context"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"verify"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"plain_password"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," hashed_password"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"get_password_hash"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"password"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"获取传入的密码的哈希值"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," pwd_context"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"hash"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"password"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"get_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"db"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"根据用户名从指定数据库中获取用户"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," username "),s("span",{style:{color:"#89DDFF"}},"in"),s("span",{style:{color:"#EEFFFF"}}," db"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        user_dict "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," db"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#EEFFFF"}},"username"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"UserInDB"),s("span",{style:{color:"#89DDFF"}},"(**"),s("span",{style:{color:"#82AAFF"}},"user_dict"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"authenticate_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"fake_db"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"password"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"身份验证, 返回用户对象或者 False"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    user "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"get_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"fake_db"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," username"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"not"),s("span",{style:{color:"#EEFFFF"}}," user"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"False")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"not"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"verify_password"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"password"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," user"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"hashed_password"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"False")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," user")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," passlib.context "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," CryptContext")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"pwd_context "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," CryptContext("),s("span",{style:{color:"#E36209"}},"schemes"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"["),s("span",{style:{color:"#032F62"}},'"bcrypt"'),s("span",{style:{color:"#24292E"}},"], "),s("span",{style:{color:"#E36209"}},"deprecated"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#032F62"}},'"auto"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"verify_password"),s("span",{style:{color:"#24292E"}},"(plain_password, hashed_password):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#032F62"}},"    校验密码是否正确")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#032F62"}},"    将传入的明文密码与数据库中的哈希值进行比对")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#032F62"}},'    """')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," pwd_context.verify(plain_password, hashed_password)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"get_password_hash"),s("span",{style:{color:"#24292E"}},"(password):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""获取传入的密码的哈希值"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," pwd_context.hash(password)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"get_user"),s("span",{style:{color:"#24292E"}},"(db, username: "),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""根据用户名从指定数据库中获取用户"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," username "),s("span",{style:{color:"#D73A49"}},"in"),s("span",{style:{color:"#24292E"}}," db:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        user_dict "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," db[username]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," UserInDB("),s("span",{style:{color:"#D73A49"}},"**"),s("span",{style:{color:"#24292E"}},"user_dict)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"authenticate_user"),s("span",{style:{color:"#24292E"}},"(fake_db, username: "),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}},", password: "),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""身份验证, 返回用户对象或者 False"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    user "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," get_user(fake_db, username)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"not"),s("span",{style:{color:"#24292E"}}," user:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"False")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"not"),s("span",{style:{color:"#24292E"}}," verify_password(password, user.hashed_password):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"False")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," user")])])]),s("button",{class:"collapse"})],-1),Ds={id:"创建-jwt-token",tabindex:"-1"},Es=s("p",null,"完成认证之后,就可以给用户创建 token 了",-1),ds=s("p",null,"首先,定义 jwt 的加密密钥,加密算法和过期时间",-1),us=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"SECRET_KEY "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"ALGORITHM "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"HS256"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"ACCESS_TOKEN_EXPIRE_MINUTES "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"30")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#005CC5"}},"SECRET_KEY"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},'"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#005CC5"}},"ALGORITHM"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},'"HS256"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#005CC5"}},"ACCESS_TOKEN_EXPIRE_MINUTES"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"30")])])]),s("button",{class:"collapse"})],-1),_s=s("div",{class:"warning custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"注意"),s("span",{lang:"zh-CN"},"注意")]),s("p",null,"在实际项目中,jwt 的密钥不应该直接写在代码中,而是应该从环境变量中读取"),s("p",null,"例如,从环境变量中获取 SECRET_KEY"),s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," os")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"SECRET_KEY "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," os"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"environ"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"get"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"SECRET_KEY"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," os")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#005CC5"}},"SECRET_KEY"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," os.environ.get("),s("span",{style:{color:"#032F62"}},'"SECRET_KEY"'),s("span",{style:{color:"#24292E"}},")")])])]),s("button",{class:"collapse"})])],-1),As=s("p",null,"然后写创建 token 的函数",-1),hs=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," datetime "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," datetime"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," timedelta")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," jose "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," JWTError"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," jwt")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"create_access_token"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"data"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"dict"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"expires_delta"),s("span",{style:{color:"#89DDFF"}},"=None):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"创建 jwt token"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    to_encode "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," data"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"copy"),s("span",{style:{color:"#89DDFF"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," expires_delta"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        expire "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," datetime"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"utcnow"),s("span",{style:{color:"#89DDFF"}},"()"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#EEFFFF"}}," expires_delta")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        expire "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," datetime"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"utcnow"),s("span",{style:{color:"#89DDFF"}},"()"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"timedelta"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"minutes"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"15"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    to_encode"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"update"),s("span",{style:{color:"#89DDFF"}},"({"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"exp"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#82AAFF"}}," expire"),s("span",{style:{color:"#89DDFF"}},"})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 注意这里就用到了上面定义的 SECRET_KEY 和 ALGORITHM")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    encoded_jwt "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," jwt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"encode"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"to_encode"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," SECRET_KEY"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"algorithm"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"ALGORITHM"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," encoded_jwt")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," datetime "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," datetime, timedelta")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," jose "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," JWTError, jwt")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"create_access_token"),s("span",{style:{color:"#24292E"}},"(data: "),s("span",{style:{color:"#005CC5"}},"dict"),s("span",{style:{color:"#24292E"}},", expires_delta"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""创建 jwt token"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    to_encode "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," data.copy()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," expires_delta:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        expire "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," datetime.utcnow() "),s("span",{style:{color:"#D73A49"}},"+"),s("span",{style:{color:"#24292E"}}," expires_delta")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"else"),s("span",{style:{color:"#24292E"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        expire "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," datetime.utcnow() "),s("span",{style:{color:"#D73A49"}},"+"),s("span",{style:{color:"#24292E"}}," timedelta("),s("span",{style:{color:"#E36209"}},"minutes"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#005CC5"}},"15"),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    to_encode.update({"),s("span",{style:{color:"#032F62"}},'"exp"'),s("span",{style:{color:"#24292E"}},": expire})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#6A737D"}},"# 注意这里就用到了上面定义的 SECRET_KEY 和 ALGORITHM")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    encoded_jwt "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," jwt.encode(to_encode, "),s("span",{style:{color:"#005CC5"}},"SECRET_KEY"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#E36209"}},"algorithm"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#005CC5"}},"ALGORITHM"),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," encoded_jwt")])])]),s("button",{class:"collapse"})],-1),fs=s("p",null,"上面这个函数把传入的用于获取 jwt 的数据进行拷贝,并添加过期时间,然后 encode 得到 jwt token 并返回",-1),Cs=s("p",null,"至此,我们完成了对用户的校验和认证,以及创建 jwt token 的功能,下面我们要在接口中使用它们",-1),ms={id:"提供登录并创建token的接口",tabindex:"-1"},ks=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," fastapi "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," Depends"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," FastAPI"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," HTTPException"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," status")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#EEFFFF"}}," fastapi"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"security "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#EEFFFF"}}," OAuth2PasswordBearer"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," OAuth2PasswordRequestForm")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"oauth2_scheme "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"OAuth2PasswordBearer"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"tokenUrl"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"token"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#82AAFF"}},"app"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"post"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/token"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"response_model"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"Token"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"async"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"login_for_access_token"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"form_data"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," OAuth2PasswordRequestForm "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"Depends"),s("span",{style:{color:"#89DDFF"}},"()):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"登录并获取 token"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 通过用户名和密码获取用户, 如果用户不存在或者密码错误, 则抛出异常")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    user "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"authenticate_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"fake_users_db"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," form_data"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"username"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," form_data"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"password"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"not"),s("span",{style:{color:"#EEFFFF"}}," user"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"raise"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"HTTPException"),s("span",{style:{color:"#89DDFF"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"            "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 这部分是规范, 401 表示未授权")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"            "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"status_code"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"status"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"HTTP_401_UNAUTHORIZED"),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"            "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"detail"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Incorrect username or password"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"            "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"headers"),s("span",{style:{color:"#89DDFF"}},"={"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"WWW-Authenticate"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Bearer"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"        "),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 上面已经相当于进行了用户身份验证, 所以这里可以直接创建 token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    access_token_expires "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"timedelta"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"minutes"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"ACCESS_TOKEN_EXPIRE_MINUTES"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    access_token "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"create_access_token"),s("span",{style:{color:"#89DDFF"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"        "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"data"),s("span",{style:{color:"#89DDFF"}},"={"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"sub"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#82AAFF"}}," user"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"username"),s("span",{style:{color:"#89DDFF"}},"},"),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"expires_delta"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"access_token_expires")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"    "),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 这里如何返回也是规范, 我们已在上面已经定义好了 response_model=Token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"access_token"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," access_token"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"token_type"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"bearer"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"}")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," fastapi "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," Depends, FastAPI, HTTPException, status")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"from"),s("span",{style:{color:"#24292E"}}," fastapi.security "),s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," OAuth2PasswordBearer, OAuth2PasswordRequestForm")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"oauth2_scheme "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," OAuth2PasswordBearer("),s("span",{style:{color:"#E36209"}},"tokenUrl"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#032F62"}},'"token"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"@app.post"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"/token"'),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#E36209"}},"response_model"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"Token)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"async"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"login_for_access_token"),s("span",{style:{color:"#24292E"}},"(form_data: OAuth2PasswordRequestForm "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," Depends()):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""登录并获取 token"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#6A737D"}},"# 通过用户名和密码获取用户, 如果用户不存在或者密码错误, 则抛出异常")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    user "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," authenticate_user(fake_users_db, form_data.username, form_data.password)")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"not"),s("span",{style:{color:"#24292E"}}," user:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"raise"),s("span",{style:{color:"#24292E"}}," HTTPException(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"            "),s("span",{style:{color:"#6A737D"}},"# 这部分是规范, 401 表示未授权")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"            "),s("span",{style:{color:"#E36209"}},"status_code"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"status."),s("span",{style:{color:"#005CC5"}},"HTTP_401_UNAUTHORIZED"),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"            "),s("span",{style:{color:"#E36209"}},"detail"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#032F62"}},'"Incorrect username or password"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"            "),s("span",{style:{color:"#E36209"}},"headers"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"{"),s("span",{style:{color:"#032F62"}},'"WWW-Authenticate"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"Bearer"'),s("span",{style:{color:"#24292E"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        )")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#6A737D"}},"# 上面已经相当于进行了用户身份验证, 所以这里可以直接创建 token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    access_token_expires "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," timedelta("),s("span",{style:{color:"#E36209"}},"minutes"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#005CC5"}},"ACCESS_TOKEN_EXPIRE_MINUTES"),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    access_token "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," create_access_token(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#E36209"}},"data"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"{"),s("span",{style:{color:"#032F62"}},'"sub"'),s("span",{style:{color:"#24292E"}},": user.username}, "),s("span",{style:{color:"#E36209"}},"expires_delta"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"access_token_expires")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    )")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#6A737D"}},"# 这里如何返回也是规范, 我们已在上面已经定义好了 response_model=Token")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," {"),s("span",{style:{color:"#032F62"}},'"access_token"'),s("span",{style:{color:"#24292E"}},": access_token, "),s("span",{style:{color:"#032F62"}},'"token_type"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"bearer"'),s("span",{style:{color:"#24292E"}},"}")])])]),s("button",{class:"collapse"})],-1),gs=s("p",null,[s("code",null,'oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")'),l(" 声明了用户应该从哪个路由获取 token (相对路径),但是并未实现具体的功能")],-1),bs=s("p",null,[l("而我们自己写的 "),s("code",null,"login_for_access_token"),l(" 则是实现.")],-1),ws=s("p",null,"现在用户成功登录后,就拿到了 jwt token ,访问其他服务时,浏览器会携带 jwt token 一起发送请求",-1),Ts=s("p",null,"我们只需要在其他接口中,对用户传来的 jwt token 进行验证即可",-1),js={id:"在其他接口中验证jwt-token",tabindex:"-1"},vs=s("p",null,[l("比如我们有一个获取用户信息的接口 "),s("code",null,"read_users_me"),l(" ,那么,我们需要:")],-1),Bs=s("ol",null,[s("li",null,"获取用户传来的 token"),s("li",null,"验证 token 是否正确和有效"),s("li",null,"通过 token 获取当前的用户信息")],-1),xs=s("p",null,"首先,解密 jwt token ,获取当前用户:",-1),Is=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"async"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"get_current_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"token"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"Depends"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"oauth2_scheme"),s("span",{style:{color:"#89DDFF"}},")):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"依赖函数, 用于获取当前用户"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 定义一个异常, 用于在用户身份验证失败时抛出")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    credentials_exception "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"HTTPException"),s("span",{style:{color:"#89DDFF"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"        "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"status_code"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"status"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"HTTP_401_UNAUTHORIZED"),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"        "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"detail"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Could not validate credentials"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"        "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"headers"),s("span",{style:{color:"#89DDFF"}},"={"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"WWW-Authenticate"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Bearer"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"    "),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"try"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        payload "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," jwt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"decode"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"token"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," SECRET_KEY"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"algorithms"),s("span",{style:{color:"#89DDFF"}},"=["),s("span",{style:{color:"#82AAFF"}},"ALGORITHM"),s("span",{style:{color:"#89DDFF"}},"])")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 从 payload 中获取 username")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 关于 sub 的解释, 可以参考文档")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        username"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"str"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," payload"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"get"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"sub"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," username "),s("span",{style:{color:"#89DDFF"}},"is"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"            "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"raise"),s("span",{style:{color:"#EEFFFF"}}," credentials_exception")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        token_data "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"TokenData"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"username"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"username"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"except"),s("span",{style:{color:"#EEFFFF"}}," JWTError"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"raise"),s("span",{style:{color:"#EEFFFF"}}," credentials_exception")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    user "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"get_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"fake_users_db"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"username"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"token_data"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"username"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," user "),s("span",{style:{color:"#89DDFF"}},"is"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"None:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"raise"),s("span",{style:{color:"#EEFFFF"}}," credentials_exception")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," user")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"async"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"get_current_active_user"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"current_user"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," User "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"Depends"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"get_current_user"),s("span",{style:{color:"#89DDFF"}},")):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"依赖函数, 用于获取当前活跃的用户,用到了上面的依赖函数 get_current_user")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#545454","font-style":"italic"}},"    为什么 current_user 可以是 User 类型而不是 get_current_user 返回的 UserInDB 类型呢?")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#545454","font-style":"italic"}},"    因为 UserInDB 类型是 User 类型的子类, 所以可以直接赋值给 User 类型的变量")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#545454","font-style":"italic"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," current_user"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"disabled"),s("span",{style:{color:"#89DDFF"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"raise"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"HTTPException"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"status_code"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F78C6C"}},"400"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"detail"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Inactive user"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," current_user")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"async"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"get_current_user"),s("span",{style:{color:"#24292E"}},"(token: "),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," Depends(oauth2_scheme)):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""依赖函数, 用于获取当前用户"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#6A737D"}},"# 定义一个异常, 用于在用户身份验证失败时抛出")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    credentials_exception "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," HTTPException(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#E36209"}},"status_code"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"status."),s("span",{style:{color:"#005CC5"}},"HTTP_401_UNAUTHORIZED"),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#E36209"}},"detail"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#032F62"}},'"Could not validate credentials"'),s("span",{style:{color:"#24292E"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#E36209"}},"headers"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"{"),s("span",{style:{color:"#032F62"}},'"WWW-Authenticate"'),s("span",{style:{color:"#24292E"}},": "),s("span",{style:{color:"#032F62"}},'"Bearer"'),s("span",{style:{color:"#24292E"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    )")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"try"),s("span",{style:{color:"#24292E"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        payload "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," jwt.decode(token, "),s("span",{style:{color:"#005CC5"}},"SECRET_KEY"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#E36209"}},"algorithms"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"["),s("span",{style:{color:"#005CC5"}},"ALGORITHM"),s("span",{style:{color:"#24292E"}},"])")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#6A737D"}},"# 从 payload 中获取 username")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#6A737D"}},"# 关于 sub 的解释, 可以参考文档")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        username: "),s("span",{style:{color:"#005CC5"}},"str"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," payload.get("),s("span",{style:{color:"#032F62"}},'"sub"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," username "),s("span",{style:{color:"#D73A49"}},"is"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"            "),s("span",{style:{color:"#D73A49"}},"raise"),s("span",{style:{color:"#24292E"}}," credentials_exception")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        token_data "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," TokenData("),s("span",{style:{color:"#E36209"}},"username"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"username)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"except"),s("span",{style:{color:"#24292E"}}," JWTError:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"raise"),s("span",{style:{color:"#24292E"}}," credentials_exception")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    user "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," get_user(fake_users_db, "),s("span",{style:{color:"#E36209"}},"username"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"token_data.username)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," user "),s("span",{style:{color:"#D73A49"}},"is"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"None"),s("span",{style:{color:"#24292E"}},":")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"raise"),s("span",{style:{color:"#24292E"}}," credentials_exception")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," user")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"async"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"get_current_active_user"),s("span",{style:{color:"#24292E"}},"(current_user: User "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," Depends(get_current_user)):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""依赖函数, 用于获取当前活跃的用户,用到了上面的依赖函数 get_current_user')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#032F62"}},"    为什么 current_user 可以是 User 类型而不是 get_current_user 返回的 UserInDB 类型呢?")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#032F62"}},"    因为 UserInDB 类型是 User 类型的子类, 所以可以直接赋值给 User 类型的变量")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#032F62"}},'    """')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," current_user.disabled:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"raise"),s("span",{style:{color:"#24292E"}}," HTTPException("),s("span",{style:{color:"#E36209"}},"status_code"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#005CC5"}},"400"),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#E36209"}},"detail"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#032F62"}},'"Inactive user"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," current_user")])])]),s("button",{class:"collapse"})],-1),Ps=s("p",null,[l("在 数据库与模型 中, 我们定义的 "),s("code",null,"TokenData"),l(" 就是这里要用的")],-1),Us=s("p",null,[l("因为只是演示,所以这个 "),s("code",null,"TokenData"),l(" 类显得有点多此一举.")],-1),Ws=s("p",null,[l("但是如果你需要传递多个 JWT 数据，或者有多个函数需要访问 JWT 数据，那么 "),s("code",null,"TokenData"),l(" 类可以方便地将这些数据打包在一起，并在函数之间传递它们。")],-1),Js=s("p",null,"之后就可以在接口中利用依赖注入,验证用户请求",-1),Ns=s("div",{class:"language-python"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"python"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#82AAFF"}},"app"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"get"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"/users/me/"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"response_model"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#82AAFF"}},"User"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"async"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C792EA"}},"def"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"read_users_me"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF","font-style":"italic"}},"current_user"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," User "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"Depends"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"get_current_active_user"),s("span",{style:{color:"#89DDFF"}},")):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""'),s("span",{style:{color:"#545454","font-style":"italic"}},"获取当前用户信息"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},'"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),s("span",{style:{color:"#EEFFFF"}}," current_user")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"@app.get"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"/users/me/"'),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#E36209"}},"response_model"),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}},"User)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"async"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#D73A49"}},"def"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"read_users_me"),s("span",{style:{color:"#24292E"}},"(current_user: User "),s("span",{style:{color:"#D73A49"}},"="),s("span",{style:{color:"#24292E"}}," Depends(get_current_active_user)):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"""获取当前用户信息"""')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"return"),s("span",{style:{color:"#24292E"}}," current_user")])])]),s("button",{class:"collapse"})],-1),Ss={id:"总结",tabindex:"-1"},Os=s("p",null,"JWT 是一种认证方式,它的本质是一段带有签名的字符串.",-1),Rs=s("p",null,[l("在 Python 中,我们可以使用 "),s("code",null,"jwt"),l(" 模块来创建和解析 jwt token.")],-1),Ms=s("p",null,[l("在 FastAPI 中,我们可以使用 "),s("code",null,"OAuth2PasswordBearer"),l(" 来获取用户传来的 token,然后使用 "),s("code",null,"jwt"),l(" 模块来解析 token,从而获取用户信息.")],-1),Hs={id:"参考",tabindex:"-1"};function Ks(e,$s,Gs,Ys,F,Zs){const n=_,r=p;return d(),E(r,{frontmatter:F.frontmatter,data:F.data},{"main-content-md":o(()=>[s("h2",f,[l("什么是 JWT "),a(n,{class:"header-anchor",href:"#什么是-jwt","aria-label":'Permalink to "什么是 JWT"'},{default:o(()=>[l("​")]),_:1})]),C,m,k,g,u(" more "),b,w,T,j,v,B,x,I,P,U,W,J,N,s("h3",S,[l("JWT 有什么用 "),a(n,{class:"header-anchor",href:"#jwt-有什么用","aria-label":'Permalink to "JWT 有什么用"'},{default:o(()=>[l("​")]),_:1})]),O,R,M,H,s("h2",K,[l("FastAPI 实现 Bearer JWT 令牌验证 "),a(n,{class:"header-anchor",href:"#fastapi-实现-bearer-jwt-令牌验证","aria-label":'Permalink to "FastAPI 实现 Bearer JWT 令牌验证"'},{default:o(()=>[l("​")]),_:1})]),$,G,Y,Z,L,V,X,z,Q,q,s("h3",ss,[l("数据库与模型 "),a(n,{class:"header-anchor",href:"#数据库与模型","aria-label":'Permalink to "数据库与模型"'},{default:o(()=>[l("​")]),_:1})]),ls,os,es,ns,as,ts,cs,Fs,rs,s("h3",ps,[l("对用户名和密码的校验与认证 "),a(n,{class:"header-anchor",href:"#对用户名和密码的校验与认证","aria-label":'Permalink to "对用户名和密码的校验与认证"'},{default:o(()=>[l("​")]),_:1})]),ys,is,s("h3",Ds,[l("创建 jwt token "),a(n,{class:"header-anchor",href:"#创建-jwt-token","aria-label":'Permalink to "创建 jwt token"'},{default:o(()=>[l("​")]),_:1})]),Es,ds,us,_s,As,hs,fs,Cs,s("h3",ms,[l("提供登录并创建token的接口 "),a(n,{class:"header-anchor",href:"#提供登录并创建token的接口","aria-label":'Permalink to "提供登录并创建token的接口"'},{default:o(()=>[l("​")]),_:1})]),ks,gs,bs,ws,Ts,s("h3",js,[l("在其他接口中验证jwt token "),a(n,{class:"header-anchor",href:"#在其他接口中验证jwt-token","aria-label":'Permalink to "在其他接口中验证jwt token"'},{default:o(()=>[l("​")]),_:1})]),vs,Bs,xs,Is,Ps,Us,Ws,Js,Ns,s("h2",Ss,[l("总结 "),a(n,{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},{default:o(()=>[l("​")]),_:1})]),Os,Rs,Ms,s("h2",Hs,[l("参考 "),a(n,{class:"header-anchor",href:"#参考","aria-label":'Permalink to "参考"'},{default:o(()=>[l("​")]),_:1})]),s("p",null,[a(n,{href:"https://jwt.io/introduction/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("JWT 官方文档")]),_:1})]),s("p",null,[a(n,{href:"https://fastapi.tiangolo.com/tutorial/security/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("FastAPI 官方文档 - 安全性")]),_:1})]),s("p",null,[a(n,{href:"https://fastapi.tiangolo.com/tutorial/dependencies/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("FastAPI 官方文档 - 依赖注入")]),_:1})])]),"main-header":o(()=>[t(e.$slots,"main-header")]),"main-header-after":o(()=>[t(e.$slots,"main-header-after")]),"main-nav":o(()=>[t(e.$slots,"main-nav")]),"main-content":o(()=>[t(e.$slots,"main-content")]),"main-content-after":o(()=>[t(e.$slots,"main-content-after")]),"main-nav-before":o(()=>[t(e.$slots,"main-nav-before")]),"main-nav-after":o(()=>[t(e.$slots,"main-nav-after")]),comment:o(()=>[t(e.$slots,"comment")]),footer:o(()=>[t(e.$slots,"footer")]),aside:o(()=>[t(e.$slots,"aside")]),"aside-custom":o(()=>[t(e.$slots,"aside-custom")]),default:o(()=>[t(e.$slots,"default")]),_:3},8,["frontmatter","data"])}const ll=y(h,[["render",Ks]]);export{sl as __pageData,ll as default};
