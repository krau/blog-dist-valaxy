import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BpGoxE0S.js";import{c as m,w as a,f as g,e as C,p as k,o as u,g as s,h as l,v as y,r as e}from"./app-DYwnrrn0.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-BzH1ppc2.js";import"./YunCard.vue_vue_type_script_setup_true_lang-BeOWRhvZ.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-B_Gh7fdw.js";import"./post-DOrnddpB.js";const F="/assets/acmessl1-Ceg50DXy.webp",$={__name:"index",setup(v,{expose:p}){const n=JSON.parse('{"title":"使用ACME脚本申请并配置 SSL 证书","description":"","frontmatter":{"categories":"小技术","date":"2022-04-22 16:48:01","layout":"post","tags":["SSL"],"title":"使用ACME脚本申请并配置 SSL 证书","updated":"2022-04-22 16:48:01"},"headers":[{"level":2,"title":"为什么选择ACME","slug":"为什么选择acme","link":"#为什么选择acme","children":[]},{"level":2,"title":"准备工作与脚本安装","slug":"准备工作与脚本安装","link":"#准备工作与脚本安装","children":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]}]},{"level":2,"title":"证书申请","slug":"证书申请","link":"#证书申请","children":[{"level":3,"title":"监听80端口申请证书","slug":"监听80端口申请证书","link":"#监听80端口申请证书","children":[]},{"level":3,"title":"通过Nginx服务申请","slug":"通过nginx服务申请","link":"#通过nginx服务申请","children":[]}]},{"level":2,"title":"安装证书到指定路径","slug":"安装证书到指定路径","link":"#安装证书到指定路径","children":[]},{"level":2,"title":"善后工作","slug":"善后工作","link":"#善后工作","children":[]}],"relativePath":"pages/posts/acmessl/index.md","path":"/home/runner/work/blog-source-valaxy/blog-source-valaxy/pages/posts/acmessl/index.md","lastUpdated":1726839524000}'),h=C(),r=n.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},n.frontmatter||{}),k("pageData",n),k("valaxy:frontmatter",r),globalThis.$frontmatter=r,p({frontmatter:{categories:"小技术",date:"2022-04-22 16:48:01",layout:"post",tags:["SSL"],title:"使用ACME脚本申请并配置 SSL 证书",updated:"2022-04-22 16:48:01"}}),(t,i)=>{const o=d;return u(),m(o,{frontmatter:g(r)},{"main-content-md":a(()=>[i[0]||(i[0]=s("h2",{id:"为什么选择acme",tabindex:"-1"},[l("为什么选择ACME "),s("a",{class:"header-anchor",href:"#为什么选择acme","aria-label":'Permalink to "为什么选择ACME"'},"​")],-1)),i[1]||(i[1]=s("p",null,"要想通过 TLS 访问自己域名下的服务, 就必须申请证书。类似宝塔这种面板提供了简单快捷的方法一键申请, 但终究不是良好的解决方案。一来宝塔过于臃肿, 二来其需要手机实名验证。使用各大云服务商提供的【免费证书】则还需要登录网页、申请、导入证书, 未免操作繁琐。更何况这些云服务商提供的证书只能给你很少的自由选择性。",-1)),i[2]||(i[2]=s("p",null,"而ACME则很好地解决了这些问题。",-1)),y(" more "),i[3]||(i[3]=s("p",null,"系统环境: Debian",-1)),i[4]||(i[4]=s("h2",{id:"准备工作与脚本安装",tabindex:"-1"},[l("准备工作与脚本安装 "),s("a",{class:"header-anchor",href:"#准备工作与脚本安装","aria-label":'Permalink to "准备工作与脚本安装"'},"​")],-1)),i[5]||(i[5]=s("p",null,"在开始之前, 首先将域名解析到服务器的ip上。",-1)),i[6]||(i[6]=s("h3",{id:"安装",tabindex:"-1"},[l("安装 "),s("a",{class:"header-anchor",href:"#安装","aria-label":'Permalink to "安装"'},"​")],-1)),i[7]||(i[7]=s("p",null,"首先安装socat, 它是acme所需的组件",-1)),i[8]||(i[8]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," update")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"apt"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," install"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," socat"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," -y")])])]),s("button",{class:"collapse"})],-1)),i[9]||(i[9]=s("p",null,"然后安装acme脚本",-1)),i[10]||(i[10]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"curl"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," https://get.acme.sh"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}}," sh")])])]),s("button",{class:"collapse"})],-1)),i[11]||(i[11]=s("p",null,[l("脚本安装在用户目录下的"),s("code",null,".acme.sh"),l("（隐藏）文件夹内, 使用 "),s("code",null,". .bashrc"),l(" 让acme.sh命令生效")],-1)),i[12]||(i[12]=s("p",null,"接下来使用脚本申请证书",-1)),i[13]||(i[13]=s("h2",{id:"证书申请",tabindex:"-1"},[l("证书申请 "),s("a",{class:"header-anchor",href:"#证书申请","aria-label":'Permalink to "证书申请"'},"​")],-1)),i[14]||(i[14]=s("p",null,"首先注册CA账户, 将下列命令中的邮箱改为自己的邮箱地址",-1)),i[15]||(i[15]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"acme.sh"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --register-account"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," -m"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," xxxx@xxxx.com")])])]),s("button",{class:"collapse"})],-1)),i[16]||(i[16]=s("p",null,"注册成功的输出结果如下",-1)),i[17]||(i[17]=s("p",null,[s("img",{src:F,alt:"1"}),l("_注册成功")],-1)),i[18]||(i[18]=s("p",null,"然后申请证书, 接下来的方法有多种, 根据自己情况选择可用的一种即可",-1)),i[19]||(i[19]=s("h3",{id:"监听80端口申请证书",tabindex:"-1"},[l("监听80端口申请证书 "),s("a",{class:"header-anchor",href:"#监听80端口申请证书","aria-label":'Permalink to "监听80端口申请证书"'},"​")],-1)),i[20]||(i[20]=s("p",null,"如果服务器的80端口空闲, 且能够访问, 可以让acme临时监听80端口, 完成验证。执行以下命令即可。将domain.com改为自己的域名",-1)),i[21]||(i[21]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"acme.sh"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --issue"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," domain.com"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --standalone")])])]),s("button",{class:"collapse"})],-1)),i[22]||(i[22]=s("h3",{id:"通过nginx服务申请",tabindex:"-1"},[l("通过Nginx服务申请 "),s("a",{class:"header-anchor",href:"#通过nginx服务申请","aria-label":'Permalink to "通过Nginx服务申请"'},"​")],-1)),i[23]||(i[23]=s("p",null,"如果服务器上已经安装了nginx, 且网页能够正常打开, 执行以下命令即可通过nginx验证并申请证书。",-1)),i[24]||(i[24]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"acme.sh"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --issue"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," mydomain.com"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --nginx")])])]),s("button",{class:"collapse"})],-1)),i[25]||(i[25]=s("hr",null,null,-1)),i[26]||(i[26]=s("p",null,"如果成功申请了证书, 将会看到的输出结果是一长串自己的证书和证书文件存放路径。",-1)),i[27]||(i[27]=s("h2",{id:"安装证书到指定路径",tabindex:"-1"},[l("安装证书到指定路径 "),s("a",{class:"header-anchor",href:"#安装证书到指定路径","aria-label":'Permalink to "安装证书到指定路径"'},"​")],-1)),i[28]||(i[28]=s("p",null,"生成的证书文件默认存放在与acme.sh脚本相同文件夹内, 大多数情况下不应直接使用该路径下的证书文件, 而使用以下命令安装证书到指定路径。",-1)),i[29]||(i[29]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"acme.sh"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --install-cert"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," domain.com"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --key-file"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"pat"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"h"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},">"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"privkey.pem"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --fullchain-file"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," <"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"pat"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"h"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},">"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"fullchain.pem")])])]),s("button",{class:"collapse"})],-1)),i[30]||(i[30]=s("p",null,[l("其中"),s("code",null,"--key-file <path>privkey.pem"),l("指定的为私钥文件, "),s("code",null,"--fullchain-file <path>fullchain.pem"),l("为证书文件。")],-1)),i[31]||(i[31]=s("p",null,"done",-1)),i[32]||(i[32]=s("h2",{id:"善后工作",tabindex:"-1"},[l("善后工作 "),s("a",{class:"header-anchor",href:"#善后工作","aria-label":'Permalink to "善后工作"'},"​")],-1)),i[33]||(i[33]=s("p",null,"在安装acme.sh脚本时, 它自动为创建 cronjob, 每天 0:00 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书。 但由于acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也应当经常更新以保持同步。参考以下命令",-1)),i[34]||(i[34]=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"acme.sh"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --upgrade"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --auto-upgrade"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"  #开启acme的自动更新")]),l(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"acme.sh"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --upgrade"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C3E88D"}}," --auto-upgrade"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F78C6C"}}," 0"),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"  #关闭自动更新")])])]),s("button",{class:"collapse"})],-1))]),"main-header":a(()=>[e(t.$slots,"main-header")]),"main-header-after":a(()=>[e(t.$slots,"main-header-after")]),"main-nav":a(()=>[e(t.$slots,"main-nav")]),"main-content":a(()=>[e(t.$slots,"main-content")]),"main-content-after":a(()=>[e(t.$slots,"main-content-after")]),"main-nav-before":a(()=>[e(t.$slots,"main-nav-before")]),"main-nav-after":a(()=>[e(t.$slots,"main-nav-after")]),comment:a(()=>[e(t.$slots,"comment")]),footer:a(()=>[e(t.$slots,"footer")]),aside:a(()=>[e(t.$slots,"aside")]),"aside-custom":a(()=>[e(t.$slots,"aside-custom")]),default:a(()=>[e(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{$ as default};
