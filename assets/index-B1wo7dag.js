import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang-BpGoxE0S.js";import{c as y,w as l,f as D,e as g,p as F,o,g as i,h as s,v as E,r as k}from"./app-DYwnrrn0.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-BzH1ppc2.js";import"./YunCard.vue_vue_type_script_setup_true_lang-BeOWRhvZ.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-B_Gh7fdw.js";import"./post-DOrnddpB.js";const f="/assets/fastapi-jwt_03-22-11-28-26-D9njXLCP.webp",T={__name:"index",setup(A,{expose:r}){const a=JSON.parse('{"title":"JWT 认证及其在 FastAPI 中的使用","description":"","frontmatter":{"title":"JWT 认证及其在 FastAPI 中的使用","date":"2023-03-22 10:59:53","updated":"2023-03-22 10:59:53","tags":["Python","代码","FastAPi"],"categories":["小技术"]},"headers":[{"level":2,"title":"什么是 JWT","slug":"什么是-jwt","link":"#什么是-jwt","children":[{"level":3,"title":"JWT 有什么用","slug":"jwt-有什么用","link":"#jwt-有什么用","children":[]}]},{"level":2,"title":"FastAPI 实现 Bearer JWT 令牌验证","slug":"fastapi-实现-bearer-jwt-令牌验证","link":"#fastapi-实现-bearer-jwt-令牌验证","children":[{"level":3,"title":"数据库与模型","slug":"数据库与模型","link":"#数据库与模型","children":[]},{"level":3,"title":"对用户名和密码的校验与认证","slug":"对用户名和密码的校验与认证","link":"#对用户名和密码的校验与认证","children":[]},{"level":3,"title":"创建 jwt token","slug":"创建-jwt-token","link":"#创建-jwt-token","children":[]},{"level":3,"title":"提供登录并创建token的接口","slug":"提供登录并创建token的接口","link":"#提供登录并创建token的接口","children":[]},{"level":3,"title":"在其他接口中验证jwt token","slug":"在其他接口中验证jwt-token","link":"#在其他接口中验证jwt-token","children":[]}]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"pages/posts/fastapi-jwt/index.md","path":"/home/runner/work/blog-source-valaxy/blog-source-valaxy/pages/posts/fastapi-jwt/index.md","lastUpdated":1726839524000}'),e=g(),n=a.frontmatter||{};return e.meta.frontmatter=Object.assign(e.meta.frontmatter||{},a.frontmatter||{}),F("pageData",a),F("valaxy:frontmatter",n),globalThis.$frontmatter=n,r({frontmatter:{title:"JWT 认证及其在 FastAPI 中的使用",date:"2023-03-22 10:59:53",updated:"2023-03-22 10:59:53",tags:["Python","代码","FastAPi"],categories:["小技术"]}}),(h,t)=>{const p=d;return o(),y(p,{frontmatter:D(n)},{"main-content-md":l(()=>[t[0]||(t[0]=i("h2",{id:"什么是-jwt",tabindex:"-1"},[s("什么是 JWT "),i("a",{class:"header-anchor",href:"#什么是-jwt","aria-label":'Permalink to "什么是 JWT"'},"​")],-1)),t[1]||(t[1]=i("p",null,"JWT: JSON Web Tokens,它是一种将 JSON 对象编码为没有空格，且难以理解的长字符串的标准。在具体上,它就是一段字符串,下面就是 FastAPI 文档中给出的例子",-1)),t[2]||(t[2]=i("div",{class:"language-txt vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"txt"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c")])])]),i("button",{class:"collapse"})],-1)),t[3]||(t[3]=i("p",null,"抽象地把它看成是这样的",-1)),t[4]||(t[4]=i("div",{class:"language-txt vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"txt"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"aaaaaaaaaaaa.bbbbbbbbbbbb.cccccccccccc")])])]),i("button",{class:"collapse"})],-1)),E(" more "),t[5]||(t[5]=i("p",null,[s("jwt 由三个部分组成,这三个部分之间用点"),i("code",null,"."),s("拼接起来,这三个部分分别是")],-1)),t[6]||(t[6]=i("ul",null,[i("li",null,"Header — 头,定义了 jwt 使用的算法等信息"),i("li",null,"Payload — 载荷,存储有效信息的地方"),i("li",null,"Signature — 签名,用于校验 jwt 令牌")],-1)),t[7]||(t[7]=i("p",null,"这三个部分中,只有第三个部分是无法还原的,前两个部分只是简单的进行了 base64 编码,把上面例子中的前两部分解码之后,看起来是这样的:",-1)),t[8]||(t[8]=i("p",null,"Header:",-1)),t[9]||(t[9]=i("div",{class:"language-json vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"json"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'    "'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C792EA"}},"alg"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"HS256"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'    "'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C792EA"}},"typ"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"JWT"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"}")])])]),i("button",{class:"collapse"})],-1)),t[10]||(t[10]=i("p",null,"alg 即为算法,这里使用了 HS256 算法",-1)),t[11]||(t[11]=i("p",null,"typ 即为类型,指明这里是一个 JWT 字符串",-1)),t[12]||(t[12]=i("p",null,"Payload",-1)),t[13]||(t[13]=i("div",{class:"language-json vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"json"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'    "'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C792EA"}},"sub"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"1234567890"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'    "'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C792EA"}},"name"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"John Doe"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'    "'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#C792EA"}},"iat"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F78C6C"}},"1516239022")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"}")])])]),i("button",{class:"collapse"})],-1)),t[14]||(t[14]=i("p",null,"可以看到 Payload 中存储了主要的信息",-1)),t[15]||(t[15]=i("div",{class:"tip custom-block"},[i("p",{class:"custom-block-title"},[i("span",{lang:"en"},"提示"),i("span",{lang:"zh-CN"},"提示")]),i("p",null,[s("根据 JWT 规范, Payload 中的 "),i("code",null,"sub"),s(" 是一个预定义的声明（Claim），表示JWT的主题（"),i("strong",null,"Subject"),s("）。它指定了JWT所代表的实体或主题，通常是用户或客户端应用程序。 "),i("code",null,"sub"),s("声明的值是字符串类型，通常是"),i("strong",null,"唯一"),s("标识用户或客户端应用程序的ID。")])],-1)),t[16]||(t[16]=i("p",null,"而 Signature 则是通过加盐加密得到的,加密由服务端实现",-1)),t[17]||(t[17]=i("div",{class:"tip custom-block"},[i("p",{class:"custom-block-title"},[i("span",{lang:"en"},"关于具体如何实现"),i("span",{lang:"zh-CN"},"关于具体如何实现")]),i("p",null,"参考下图"),i("figure",null,[i("img",{src:f,alt:"图 1",loading:"lazy",decoding:"async"})]),i("p",null,[s("即,把 header 和 payload 部分进行 base64编码,用点拼接起来,得到"),i("strong",null,"结果"),s(",把这个结果用我们设置的密钥和算法进行加盐加密,就得到了 Signature")])],-1)),t[18]||(t[18]=i("h3",{id:"jwt-有什么用",tabindex:"-1"},[s("JWT 有什么用 "),i("a",{class:"header-anchor",href:"#jwt-有什么用","aria-label":'Permalink to "JWT 有什么用"'},"​")],-1)),t[19]||(t[19]=i("p",null,"其实它与 token ,cookie 的作用类似,就是用来免密码认证客户端",-1)),t[20]||(t[20]=i("p",null,"比如你去上学,学校是服务端,你是客户端.你完成学籍注册之后,学校发给你一个学生证,学生证就是你的 jwt 令牌.",-1)),t[21]||(t[21]=i("p",null,"你使用学校的很多服务,都要出示学生证.",-1)),t[22]||(t[22]=i("p",null,"而在实际业务中,jwt 令牌是有过期时间的,过期之后,需要客户端再次登录,获取新的 jwt",-1)),t[23]||(t[23]=i("h2",{id:"fastapi-实现-bearer-jwt-令牌验证",tabindex:"-1"},[s("FastAPI 实现 Bearer JWT 令牌验证 "),i("a",{class:"header-anchor",href:"#fastapi-实现-bearer-jwt-令牌验证","aria-label":'Permalink to "FastAPI 实现 Bearer JWT 令牌验证"'},"​")],-1)),t[24]||(t[24]=i("p",null,"需要安装以下几个包",-1)),t[25]||(t[25]=i("p",null,"python-jose，在 Python 中生成和校验 JWT 令牌",-1)),t[26]||(t[26]=i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"pip"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," install"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," python-jose[cryptography]")])])]),i("button",{class:"collapse"})],-1)),t[27]||(t[27]=i("p",null,"Passlib ,处理密码哈希",-1)),t[28]||(t[28]=i("div",{class:"language-bash vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"pip"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," install"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}}," passlib[bcrypt]")])])]),i("button",{class:"collapse"})],-1)),t[29]||(t[29]=i("div",{class:"warning custom-block"},[i("p",{class:"custom-block-title"},[i("span",{lang:"en"},"WARNING"),i("span",{lang:"zh-CN"},"注意")]),i("p",null,"密码哈希和 jwt 的加密不是同一个问题."),i("p",null,"哈希是指把特定内容（本例中为密码）转换为乱码形式的字节序列（其实就是字符串）。"),i("p",null,"每次传入完全相同的内容时（比如，完全相同的密码），返回的都是完全相同的乱码。"),i("p",null,"但这个乱码无法转换回传入的密码。"),i("p",null,"把密码进行哈希并存储是必要的安全措施")],-1)),t[30]||(t[30]=i("p",null,"先不考虑用户注册的问题,假设我们已经有了一个在数据库中的用户,那么这里的逻辑是这样的:",-1)),t[31]||(t[31]=i("ol",null,[i("li",null,"该用户通过用户名和密码登录"),i("li",null,"服务端对其进行校验和认证"),i("li",null,"完成认证后,用户拿到 jwt 令牌(token)"),i("li",null,"用户使用 jwt 令牌(token)访问其他服务")],-1)),t[32]||(t[32]=i("p",null,"所以,我们需要:",-1)),t[33]||(t[33]=i("ol",null,[i("li",null,"一个存储了用户信息的数据库,其中密码存储的是哈希值"),i("li",null,"用户和 jwt 令牌(token)的模型"),i("li",null,"用于从数据库中获得用户信息,并验证的函数. 包括获取用户,哈希传入的密码,验证用户等"),i("li",null,"用于创建 jwt 令牌的函数"),i("li",null,"给用户登录并获取 jwt 令牌(token)的接口"),i("li",null,"验证用户的 jwt 是否正确和有效")],-1)),t[34]||(t[34]=i("h3",{id:"数据库与模型",tabindex:"-1"},[s("数据库与模型 "),i("a",{class:"header-anchor",href:"#数据库与模型","aria-label":'Permalink to "数据库与模型"'},"​")],-1)),t[35]||(t[35]=i("p",null,"呃,为了简便和偷懒,就用 FastAPI 文档中的假数据库吧",-1)),t[36]||(t[36]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"fake_users_db "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'    "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"johndoe"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'        "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"username"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"johndoe"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'        "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"full_name"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"John Doe"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'        "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"email"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"johndoe@example.com"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'        "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"hashed_password"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'        "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"disabled"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," False"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"}")])])]),i("button",{class:"collapse"})],-1)),t[37]||(t[37]=i("p",null,"定义之后要用到的模型",-1)),t[38]||(t[38]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," pydantic "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," BaseModel")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," typing "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," Union")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}}," Token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"BaseModel"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    access_token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    token_type"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}}," TokenData"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"BaseModel"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," Union"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}},"str"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}}," User"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"BaseModel"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    email"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," Union"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}},"str"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    full_name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," Union"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}},"str"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    disabled"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," Union"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}},"bool"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"]"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}}," UserInDB"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#FFCB6B"}},"User"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    hashed_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str")])])]),i("button",{class:"collapse"})],-1)),t[39]||(t[39]=i("p",null,[i("code",null,"Token"),s(" 模型用于在登录接口中指定 "),i("code",null,"response_model")],-1)),t[40]||(t[40]=i("p",null,[i("code",null,"TokenData"),s(" 用于从 token 中获取数据")],-1)),t[41]||(t[41]=i("p",null,[i("code",null,"User"),s(" 即用户模型,供外部使用")],-1)),t[42]||(t[42]=i("p",null,[i("code",null,"UserInDB"),s(" 是用户在数据库中的模型,它继承自 "),i("code",null,"User"),s(" 添加了 "),i("code",null,"hashed_password"),s(" 属性")],-1)),t[43]||(t[43]=i("p",null,"这些模型在之后会用到",-1)),t[44]||(t[44]=i("h3",{id:"对用户名和密码的校验与认证",tabindex:"-1"},[s("对用户名和密码的校验与认证 "),i("a",{class:"header-anchor",href:"#对用户名和密码的校验与认证","aria-label":'Permalink to "对用户名和密码的校验与认证"'},"​")],-1)),t[45]||(t[45]=i("p",null,"这部分比较简单,就是把用户输入的密码哈希之后和数据库中的对比就好了",-1)),t[46]||(t[46]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," passlib"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"context "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," CryptContext")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"pwd_context "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," CryptContext"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"schemes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"bcrypt"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"],"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," deprecated"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"auto"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," verify_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"plain_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," hashed_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    校验密码是否正确")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    将传入的明文密码与数据库中的哈希值进行比对")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," pwd_context"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"verify"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"plain_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," hashed_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," get_password_hash"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"获取传入的密码的哈希值"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," pwd_context"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"hash"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," get_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"根据用户名从指定数据库中获取用户"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," username "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"in"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"        user_dict "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," UserInDB"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"user_dict"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," authenticate_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"fake_db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"身份验证, 返回用户对象或者 False"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    user "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," get_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"fake_db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," not"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," False")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," not"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," verify_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"hashed_password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," False")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," user")])])]),i("button",{class:"collapse"})],-1)),t[47]||(t[47]=i("h3",{id:"创建-jwt-token",tabindex:"-1"},[s("创建 jwt token "),i("a",{class:"header-anchor",href:"#创建-jwt-token","aria-label":'Permalink to "创建 jwt token"'},"​")],-1)),t[48]||(t[48]=i("p",null,"完成认证之后,就可以给用户创建 token 了",-1)),t[49]||(t[49]=i("p",null,"首先,定义 jwt 的加密密钥,加密算法和过期时间",-1)),t[50]||(t[50]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#EEFFFF"}},"SECRET_KEY"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#EEFFFF"}},"ALGORITHM"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"HS256"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#EEFFFF"}},"ACCESS_TOKEN_EXPIRE_MINUTES"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F78C6C"}}," 30")])])]),i("button",{class:"collapse"})],-1)),t[51]||(t[51]=i("div",{class:"warning custom-block"},[i("p",{class:"custom-block-title"},[i("span",{lang:"en"},"注意"),i("span",{lang:"zh-CN"},"注意")]),i("p",null,"在实际项目中,jwt 的密钥不应该直接写在代码中,而是应该从环境变量中读取"),i("p",null,"例如,从环境变量中获取 SECRET_KEY"),i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," os")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#EEFFFF"}},"SECRET_KEY"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," os"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"environ"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"SECRET_KEY"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")])])]),i("button",{class:"collapse"})])],-1)),t[52]||(t[52]=i("p",null,"然后写创建 token 的函数",-1)),t[53]||(t[53]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," datetime "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," datetime"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," timedelta")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," jose "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," JWTError"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," jwt")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," create_access_token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"data"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," dict"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," expires_delta"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}},"None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"创建 jwt token"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    to_encode "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," data"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"copy"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," expires_delta"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"        expire "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," datetime"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"utcnow"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"()"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," +"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," expires_delta")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    else"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"        expire "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," datetime"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"utcnow"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"()"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," +"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," timedelta"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"minutes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F78C6C"}},"15"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    to_encode"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"update"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"({"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"exp"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," expire"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"})")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    # 注意这里就用到了上面定义的 SECRET_KEY 和 ALGORITHM")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    encoded_jwt "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," jwt"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"encode"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"to_encode"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#82AAFF"}}," SECRET_KEY"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," algorithm"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#82AAFF"}},"ALGORITHM"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," encoded_jwt")])])]),i("button",{class:"collapse"})],-1)),t[54]||(t[54]=i("p",null,"上面这个函数把传入的用于获取 jwt 的数据进行拷贝,并添加过期时间,然后 encode 得到 jwt token 并返回",-1)),t[55]||(t[55]=i("p",null,"至此,我们完成了对用户的校验和认证,以及创建 jwt token 的功能,下面我们要在接口中使用它们",-1)),t[56]||(t[56]=i("h3",{id:"提供登录并创建token的接口",tabindex:"-1"},[s("提供登录并创建token的接口 "),i("a",{class:"header-anchor",href:"#提供登录并创建token的接口","aria-label":'Permalink to "提供登录并创建token的接口"'},"​")],-1)),t[57]||(t[57]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," fastapi "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," Depends"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," FastAPI"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," HTTPException"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," status")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"from"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," fastapi"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"security "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," OAuth2PasswordBearer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," OAuth2PasswordRequestForm")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"oauth2_scheme "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," OAuth2PasswordBearer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"tokenUrl"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"token"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#89DDFF"}},"@"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}},"app"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}},"post"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"/token"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," response_model"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"Token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"async"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}}," def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," login_for_access_token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"form_data"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," OAuth2PasswordRequestForm "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," Depends"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"()):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"登录并获取 token"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    # 通过用户名和密码获取用户, 如果用户不存在或者密码错误, 则抛出异常")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    user "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," authenticate_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"fake_users_db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," form_data"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," form_data"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"password"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," not"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        raise"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," HTTPException"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"            # 这部分是规范, 401 表示未授权")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"            status_code"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"status"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F07178"}},"HTTP_401_UNAUTHORIZED"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"            detail"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"Incorrect username or password"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"            headers"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"{"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"WWW-Authenticate"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"Bearer"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"        )")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    # 上面已经相当于进行了用户身份验证, 所以这里可以直接创建 token")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    access_token_expires "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," timedelta"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"minutes"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#82AAFF"}},"ACCESS_TOKEN_EXPIRE_MINUTES"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    access_token "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," create_access_token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        data"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"{"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"sub"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"},"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," expires_delta"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"access_token_expires")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"    )")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    # 这里如何返回也是规范, 我们已在上面已经定义好了 response_model=Token")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}}," {"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"access_token"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," access_token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"token_type"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"bearer"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"}")])])]),i("button",{class:"collapse"})],-1)),t[58]||(t[58]=i("p",null,[i("code",null,'oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")'),s(" 声明了用户应该从哪个路由获取 token (相对路径),但是并未实现具体的功能")],-1)),t[59]||(t[59]=i("p",null,[s("而我们自己写的 "),i("code",null,"login_for_access_token"),s(" 则是实现.")],-1)),t[60]||(t[60]=i("p",null,"现在用户成功登录后,就拿到了 jwt token ,访问其他服务时,浏览器会携带 jwt token 一起发送请求",-1)),t[61]||(t[61]=i("p",null,"我们只需要在其他接口中,对用户传来的 jwt token 进行验证即可",-1)),t[62]||(t[62]=i("h3",{id:"在其他接口中验证jwt-token",tabindex:"-1"},[s("在其他接口中验证jwt token "),i("a",{class:"header-anchor",href:"#在其他接口中验证jwt-token","aria-label":'Permalink to "在其他接口中验证jwt token"'},"​")],-1)),t[63]||(t[63]=i("p",null,[s("比如我们有一个获取用户信息的接口 "),i("code",null,"read_users_me"),s(" ,那么,我们需要:")],-1)),t[64]||(t[64]=i("ol",null,[i("li",null,"获取用户传来的 token"),i("li",null,"验证 token 是否正确和有效"),i("li",null,"通过 token 获取当前的用户信息")],-1)),t[65]||(t[65]=i("p",null,"首先,解密 jwt token ,获取当前用户:",-1)),t[66]||(t[66]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"async"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}}," def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," get_current_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," Depends"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"oauth2_scheme"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"依赖函数, 用于获取当前用户"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    # 定义一个异常, 用于在用户身份验证失败时抛出")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    credentials_exception "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," HTTPException"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        status_code"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"status"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F07178"}},"HTTP_401_UNAUTHORIZED"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        detail"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"Could not validate credentials"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        headers"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"{"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"WWW-Authenticate"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},' "'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"Bearer"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"    )")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    try"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"        payload "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," jwt"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"decode"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"token"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#82AAFF"}}," SECRET_KEY"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," algorithms"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#82AAFF"}},"ALGORITHM"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"])")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        # 从 payload 中获取 username")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        # 关于 sub 的解释, 可以参考文档")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"        username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#FFCB6B"}}," str"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," payload"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"sub"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," username "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"is"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"            raise"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," credentials_exception")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"        token_data "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," TokenData"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"username"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    except"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," JWTError"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        raise"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," credentials_exception")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}},"    user "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," get_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"fake_users_db"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," username"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"token_data"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"username"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," user "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"is"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#89DDFF"}}," None"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        raise"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," credentials_exception")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," user")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"async"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}}," def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," get_current_active_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"current_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," User "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," Depends"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"get_current_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"依赖函数, 用于获取当前活跃的用户,用到了上面的依赖函数 get_current_user")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    为什么 current_user 可以是 User 类型而不是 get_current_user 返回的 UserInDB 类型呢?")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    因为 UserInDB 类型是 User 类型的子类, 所以可以直接赋值给 User 类型的变量")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," current_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#F07178"}},"disabled"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"        raise"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," HTTPException"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"status_code"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#F78C6C"}},"400"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," detail"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"Inactive user"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," current_user")])])]),i("button",{class:"collapse"})],-1)),t[67]||(t[67]=i("p",null,[s("在 数据库与模型 中, 我们定义的 "),i("code",null,"TokenData"),s(" 就是这里要用的")],-1)),t[68]||(t[68]=i("p",null,[s("因为只是演示,所以这个 "),i("code",null,"TokenData"),s(" 类显得有点多此一举.")],-1)),t[69]||(t[69]=i("p",null,[s("但是如果你需要传递多个 JWT 数据，或者有多个函数需要访问 JWT 数据，那么 "),i("code",null,"TokenData"),s(" 类可以方便地将这些数据打包在一起，并在函数之间传递它们。")],-1)),t[70]||(t[70]=i("p",null,"之后就可以在接口中利用依赖注入,验证用户请求",-1)),t[71]||(t[71]=i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light material-theme-darker vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#89DDFF"}},"@"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}},"app"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#89DDFF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#C3E88D"}},"/users/me/"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},","),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}}," response_model"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"User"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}},"async"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C792EA"}}," def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#82AAFF"}}," read_users_me"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"current_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},":"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," User "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}}," Depends"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#82AAFF"}},"get_current_active_user"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#89DDFF"}},")):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'    """'),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#545454","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"获取当前用户信息"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},'"""')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#89DDFF","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#EEFFFF"}}," current_user")])])]),i("button",{class:"collapse"})],-1)),t[72]||(t[72]=i("h2",{id:"总结",tabindex:"-1"},[s("总结 "),i("a",{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},"​")],-1)),t[73]||(t[73]=i("p",null,"JWT 是一种认证方式,它的本质是一段带有签名的字符串.",-1)),t[74]||(t[74]=i("p",null,[s("在 Python 中,我们可以使用 "),i("code",null,"jwt"),s(" 模块来创建和解析 jwt token.")],-1)),t[75]||(t[75]=i("p",null,[s("在 FastAPI 中,我们可以使用 "),i("code",null,"OAuth2PasswordBearer"),s(" 来获取用户传来的 token,然后使用 "),i("code",null,"jwt"),s(" 模块来解析 token,从而获取用户信息.")],-1)),t[76]||(t[76]=i("h2",{id:"参考",tabindex:"-1"},[s("参考 "),i("a",{class:"header-anchor",href:"#参考","aria-label":'Permalink to "参考"'},"​")],-1)),t[77]||(t[77]=i("p",null,[i("a",{href:"https://jwt.io/introduction/",target:"_blank",rel:"noreferrer"},"JWT 官方文档")],-1)),t[78]||(t[78]=i("p",null,[i("a",{href:"https://fastapi.tiangolo.com/tutorial/security/",target:"_blank",rel:"noreferrer"},"FastAPI 官方文档 - 安全性")],-1)),t[79]||(t[79]=i("p",null,[i("a",{href:"https://fastapi.tiangolo.com/tutorial/dependencies/",target:"_blank",rel:"noreferrer"},"FastAPI 官方文档 - 依赖注入")],-1))]),"main-header":l(()=>[k(h.$slots,"main-header")]),"main-header-after":l(()=>[k(h.$slots,"main-header-after")]),"main-nav":l(()=>[k(h.$slots,"main-nav")]),"main-content":l(()=>[k(h.$slots,"main-content")]),"main-content-after":l(()=>[k(h.$slots,"main-content-after")]),"main-nav-before":l(()=>[k(h.$slots,"main-nav-before")]),"main-nav-after":l(()=>[k(h.$slots,"main-nav-after")]),comment:l(()=>[k(h.$slots,"comment")]),footer:l(()=>[k(h.$slots,"footer")]),aside:l(()=>[k(h.$slots,"aside")]),"aside-custom":l(()=>[k(h.$slots,"aside-custom")]),default:l(()=>[k(h.$slots,"default")]),_:3},8,["frontmatter"])}}};export{T as default};
