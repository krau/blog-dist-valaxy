import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-1pTNc6v3.js";import{_ as y,u as i,p as E,c as D,w as o,o as d,b as s,d as l,e as t,a as C,r as n,f as h}from"./app-Omv9pedO.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-72Hcjeua.js";import"./YunCard.vue_vue_type_script_setup_true_lang-xCfXJehS.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-PQBhwCog.js";import"./index-nlSmcLJj.js";const vs=JSON.parse('{"title":"Go 的 gRPC 和 Protocol Buffers---TLS 认证","description":"","frontmatter":{"title":"Go 的 gRPC 和 Protocol Buffers---TLS 认证","date":"2023-10-23T09:29:29.000Z","updated":"2023-10-23T09:29:29.000Z","tags":["代码","Go","gRPC","Protobuf"],"categories":"小技术","hide":null,"author":"Krau","copyright":true,"icon":null,"cover":null,"color":"#79d4fd","comment":true,"end":false,"encrypt":false,"time_warning":false},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"SAN, CA 和证书","slug":"san-ca-和证书","link":"#san-ca-和证书","children":[]},{"level":2,"title":"生成证书","slug":"生成证书","link":"#生成证书","children":[{"level":3,"title":"生成 CA 证书","slug":"生成-ca-证书","link":"#生成-ca-证书","children":[]},{"level":3,"title":"生成服务端证书","slug":"生成服务端证书","link":"#生成服务端证书","children":[]},{"level":3,"title":"生成客户端证书","slug":"生成客户端证书","link":"#生成客户端证书","children":[]}]},{"level":2,"title":"实现","slug":"实现","link":"#实现","children":[{"level":3,"title":"服务端","slug":"服务端","link":"#服务端","children":[]},{"level":3,"title":"客户端","slug":"客户端","link":"#客户端","children":[]}]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"pages/posts/grpc-and-protobuf-in-go-tls.md","path":"/home/runner/work/blog-source-valaxy/blog-source-valaxy/pages/posts/grpc-and-protobuf-in-go-tls.md","lastUpdated":1703654135000}'),c=JSON.parse('{"title":"Go 的 gRPC 和 Protocol Buffers---TLS 认证","description":"","frontmatter":{"title":"Go 的 gRPC 和 Protocol Buffers---TLS 认证","date":"2023-10-23T09:29:29.000Z","updated":"2023-10-23T09:29:29.000Z","tags":["代码","Go","gRPC","Protobuf"],"categories":"小技术","hide":null,"author":"Krau","copyright":true,"icon":null,"cover":null,"color":"#79d4fd","comment":true,"end":false,"encrypt":false,"time_warning":false},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"SAN, CA 和证书","slug":"san-ca-和证书","link":"#san-ca-和证书","children":[]},{"level":2,"title":"生成证书","slug":"生成证书","link":"#生成证书","children":[{"level":3,"title":"生成 CA 证书","slug":"生成-ca-证书","link":"#生成-ca-证书","children":[]},{"level":3,"title":"生成服务端证书","slug":"生成服务端证书","link":"#生成服务端证书","children":[]},{"level":3,"title":"生成客户端证书","slug":"生成客户端证书","link":"#生成客户端证书","children":[]}]},{"level":2,"title":"实现","slug":"实现","link":"#实现","children":[{"level":3,"title":"服务端","slug":"服务端","link":"#服务端","children":[]},{"level":3,"title":"客户端","slug":"客户端","link":"#客户端","children":[]}]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"pages/posts/grpc-and-protobuf-in-go-tls.md","path":"/home/runner/work/blog-source-valaxy/blog-source-valaxy/pages/posts/grpc-and-protobuf-in-go-tls.md","lastUpdated":1703654135000}'),g={name:"pages/posts/grpc-and-protobuf-in-go-tls.md",data(){return{data:c,frontmatter:c.frontmatter,$frontmatter:c.frontmatter}},setup(){const e=i();e.meta.frontmatter=Object.assign(e.meta.frontmatter,c.frontmatter),E("pageData",c)}},u={id:"前言",tabindex:"-1"},m=s("p",null,"为了保证 gRPC 服务不被第三方监听和调用, 防止通信被篡改或伪造, 需要对 gRPC 服务添加身份验证机制.",-1),f=s("p",null,"目前 gRPC 内置了三种身份验证机制:",-1),A=s("ul",null,[s("li",null,[s("strong",null,"SSL/TLS"),l(": gRPC 集成了 SSL/TLS, 提倡使用 SSL/TLS 对服务器进行身份验证, 并对客户端与服务器之间交换的所有数据进行加密。同时可选让客户端提供用于相互验证的证书.")]),s("li",null,[s("strong",null,"基于 Token 的身份验证"),l(": gRPC 提供了一种可将基于元数据的凭证附加到请求和响应中的机制. 这种机制必须与 SSL/TLS 同时使用, 以提供完整的身份验证和加密通信.")]),s("li",null,[s("strong",null,"ATLS"),l(": Google 自家的双向身份验证和传输安全系统, 通常也用于在 Google 家的平台上构建服务时.")])],-1),_=s("p",null,"本文介绍 gRPC 中的 SSL/TLS.",-1),k=s("div",{class:"tip custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"TIP"),s("span",{lang:"zh-CN"},"提示")]),s("p",null,"本文环境"),s("ul",null,[s("li",null,"Debian 12 amd64"),s("li",null,"Go 1.21.3")])],-1),v={id:"san-ca-和证书",tabindex:"-1"},N=s("p",null,[l("使用 TLS 就需要证书. 在 Go 1.15 版本之后废弃了 "),s("code",null,"CommonName"),l(", 而是要使用 "),s("code",null,"Subject Alternative Name"),l(" (SAN) 来验证证书的有效性. 因此如果按照以前的方法生成证书, 大概率会导致下面的错误:")],-1),b=s("blockquote",null,[s("p",null,[s("code",null,'rpc error: code = Unavailable desc = connection error: desc = "transport: authentication handshake failed: x509: certificate relies on legacy Common Name field, use SANs or temporarily enable Common Name matching with GODEBUG=x509ignoreCN=0"')])],-1),P=s("p",null,"SAN 是 x509 定义中的一个扩展, 用于指定证书的使用范围. 使用了 SAN 扩展的证书, 可以在证书中指定多个域名或 IP 地址, 从而可以在一个证书中同时包含多个域名或 IP 地址.",-1),B=s("p",null,"CA (Certificate Authority), 即证书颁发机构, 用于管理和签发证书. 作用是检查证书持有者的合法性, 并颁发证书, 防止证书被伪造.",-1),S=s("p",null,"CA 自己也需要有证书, 称为根证书, 用于签发其他证书. 一般情况下, 根证书是自签名的, 即自己给自己签发证书. 根证书是信任链的起点, 有了根证书之后 CA 才能给其他人签发证书.",-1),x=s("p",null,"因此, 要想在 gRPC 中使用 TLS, 需要准备三组证书:",-1),L=s("ul",null,[s("li",null,"CA 根证书"),s("li",null,"服务端证书"),s("li",null,"客户端证书")],-1),w={id:"生成证书",tabindex:"-1"},R={id:"生成-ca-证书",tabindex:"-1"},T=s("p",null,[l("在任意目录下创建 "),s("code",null,"ca.conf"),l(" 文件:")],-1),q=s("div",{class:"language-ini"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"ini"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"[ req ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"default_bits"),s("span",{style:{color:"#EEFFFF"}},"       "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," 4096")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"distinguished_name"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," moe")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"[ moe ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"countryName"),s("span",{style:{color:"#EEFFFF"}},"                 "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," GB")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"countryName_default"),s("span",{style:{color:"#EEFFFF"}},"         "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," BeiJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"stateOrProvinceName"),s("span",{style:{color:"#EEFFFF"}},"         "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," State or Province Name (full name)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"stateOrProvinceName_default"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," BeiJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"localityName"),s("span",{style:{color:"#EEFFFF"}},"                "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," Locality Name (eg, city)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"localityName_default"),s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," NanJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"organizationName"),s("span",{style:{color:"#EEFFFF"}},"            "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," Organization Name (eg, company)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"organizationName_default"),s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," Kompany")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"commonName"),s("span",{style:{color:"#EEFFFF"}},"                  "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," krau.top")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"commonName_max"),s("span",{style:{color:"#EEFFFF"}},"              "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," 64")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"commonName_default"),s("span",{style:{color:"#EEFFFF"}},"          "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," krau.top")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"[ req ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"default_bits"),s("span",{style:{color:"#24292E"}},"       = 4096")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"distinguished_name"),s("span",{style:{color:"#24292E"}}," = moe")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"[ moe ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"countryName"),s("span",{style:{color:"#24292E"}},"                 = GB")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"countryName_default"),s("span",{style:{color:"#24292E"}},"         = BeiJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"stateOrProvinceName"),s("span",{style:{color:"#24292E"}},"         = State or Province Name (full name)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"stateOrProvinceName_default"),s("span",{style:{color:"#24292E"}}," = BeiJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"localityName"),s("span",{style:{color:"#24292E"}},"                = Locality Name (eg, city)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"localityName_default"),s("span",{style:{color:"#24292E"}},"        = NanJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"organizationName"),s("span",{style:{color:"#24292E"}},"            = Organization Name (eg, company)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"organizationName_default"),s("span",{style:{color:"#24292E"}},"    = Kompany")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"commonName"),s("span",{style:{color:"#24292E"}},"                  = krau.top")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"commonName_max"),s("span",{style:{color:"#24292E"}},"              = 64")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"commonName_default"),s("span",{style:{color:"#24292E"}},"          = krau.top")])])]),s("button",{class:"collapse"})],-1),O=s("p",null,"执行下面的命令生成 CA 私钥:",-1),$=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"genrsa"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"4096")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"genrsa"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"4096")])])]),s("button",{class:"collapse"})],-1),G=s("p",null,"然后生成 CA 证书:",-1),z=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"req"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-new"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-x509"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-days"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"3650"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.crt"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-config"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.conf")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"req"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-new"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-x509"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-days"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"3650"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.crt"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-config"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.conf")])])]),s("button",{class:"collapse"})],-1),J=s("p",null,[l("根据提示输入各种信息, 最后会生成 "),s("code",null,"ca.crt"),l(" 文件.")],-1),K={id:"生成服务端证书",tabindex:"-1"},I=s("p",null,[l("新建 "),s("code",null,"server.conf"),l(":")],-1),V=s("div",{class:"language-ini"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"ini"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"[ req ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"default_bits"),s("span",{style:{color:"#EEFFFF"}},"       "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," 2048")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"distinguished_name"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," moe")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"[ moe ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"countryName"),s("span",{style:{color:"#EEFFFF"}},"                 "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," Country Name (2 letter code)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"countryName_default"),s("span",{style:{color:"#EEFFFF"}},"         "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," CN")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"stateOrProvinceName"),s("span",{style:{color:"#EEFFFF"}},"         "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," State or Province Name (full name)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"stateOrProvinceName_default"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," JiangSu")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"localityName"),s("span",{style:{color:"#EEFFFF"}},"                "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," Locality Name (eg, city)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"localityName_default"),s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," NanJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"organizationName"),s("span",{style:{color:"#EEFFFF"}},"            "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," Organization Name (eg, company)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"organizationName_default"),s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," ovocom")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"commonName"),s("span",{style:{color:"#EEFFFF"}},"                  "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," CommonName (e.g. server FQDN or YOUR name)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"commonName_max"),s("span",{style:{color:"#EEFFFF"}},"              "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," 64")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"commonName_default"),s("span",{style:{color:"#EEFFFF"}},"          "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," localhost "),s("span",{style:{color:"#545454","font-style":"italic"}},"# 此值应该包含在 [alt_names] 中")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"[ req_ext ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"subjectAltName"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," @alt_names")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"[alt_names]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"DNS.1"),s("span",{style:{color:"#EEFFFF"}},"   "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," localhost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"IP"),s("span",{style:{color:"#EEFFFF"}},"      "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#EEFFFF"}}," 127.0.0.1")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"[ req ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"default_bits"),s("span",{style:{color:"#24292E"}},"       = 2048")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"distinguished_name"),s("span",{style:{color:"#24292E"}}," = moe")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"[ moe ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"countryName"),s("span",{style:{color:"#24292E"}},"                 = Country Name (2 letter code)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"countryName_default"),s("span",{style:{color:"#24292E"}},"         = CN")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"stateOrProvinceName"),s("span",{style:{color:"#24292E"}},"         = State or Province Name (full name)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"stateOrProvinceName_default"),s("span",{style:{color:"#24292E"}}," = JiangSu")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"localityName"),s("span",{style:{color:"#24292E"}},"                = Locality Name (eg, city)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"localityName_default"),s("span",{style:{color:"#24292E"}},"        = NanJing")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"organizationName"),s("span",{style:{color:"#24292E"}},"            = Organization Name (eg, company)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"organizationName_default"),s("span",{style:{color:"#24292E"}},"    = ovocom")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"commonName"),s("span",{style:{color:"#24292E"}},"                  = CommonName (e.g. server FQDN or YOUR name)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"commonName_max"),s("span",{style:{color:"#24292E"}},"              = 64")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"commonName_default"),s("span",{style:{color:"#24292E"}},"          = localhost "),s("span",{style:{color:"#6A737D"}},"# 此值应该包含在 [alt_names] 中")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"[ req_ext ]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"subjectAltName"),s("span",{style:{color:"#24292E"}}," = @alt_names")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"[alt_names]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"DNS.1"),s("span",{style:{color:"#24292E"}},"   = localhost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"IP"),s("span",{style:{color:"#24292E"}},"      = 127.0.0.1")])])]),s("button",{class:"collapse"})],-1),U=s("div",{class:"warning custom-block"},[s("p",{class:"custom-block-title"},[s("span",{lang:"en"},"WARNING"),s("span",{lang:"zh-CN"},"注意")]),s("p",null,[s("code",null,"commonName_default"),l(" 的值应该包含在 "),s("code",null,"[alt_names]"),l(" 中, 并且在连接时, 客户端的值需要与其匹配.")])],-1),M=s("p",null,"生成私钥:",-1),j=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"genrsa"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"2048")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"genrsa"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"2048")])])]),s("button",{class:"collapse"})],-1),X=s("p",null,"生成 csr:",-1),Z=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"req"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-new"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.csr"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-config"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.conf")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"req"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-new"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.csr"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-config"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.conf")])])]),s("button",{class:"collapse"})],-1),W=s("p",null,"请求 CA 签发证书:",-1),Q=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"x509"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-req"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-days"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"3650"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-in"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.csr"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-CA"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.crt"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-CAkey"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-CAcreateserial"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.crt"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-extensions"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"req_ext"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-extfile"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"server.conf")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"x509"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-req"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-days"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"3650"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-in"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.csr"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-CA"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.crt"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-CAkey"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-CAcreateserial"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.crt"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-extensions"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"req_ext"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-extfile"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"server.conf")])])]),s("button",{class:"collapse"})],-1),Y={id:"生成客户端证书",tabindex:"-1"},H=s("p",null,"客户端不需要配置文件, 直接生成私钥:",-1),ss=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"genrsa"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"client.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"2048")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"genrsa"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"client.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"2048")])])]),s("button",{class:"collapse"})],-1),ls=s("p",null,"生成 csr:",-1),os=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"req"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-new"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"client.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"client.csr")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"req"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-new"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"client.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"client.csr")])])]),s("button",{class:"collapse"})],-1),es=s("p",null,"请求 CA 签发证书:",-1),ns=s("div",{class:"language-bash"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"bash"),s("pre",{class:"shiki material-theme-darker vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"openssl"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"x509"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-req"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-days"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#F78C6C"}},"3650"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-in"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"client.csr"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-CA"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.crt"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-CAkey"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"ca.key"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-CAcreateserial"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"-out"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#C3E88D"}},"client.crt")])])]),s("pre",{class:"shiki github-light vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#6F42C1"}},"openssl"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"x509"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-req"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-days"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"3650"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-in"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"client.csr"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-CA"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.crt"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-CAkey"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"ca.key"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-CAcreateserial"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"-out"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#032F62"}},"client.crt")])])]),s("button",{class:"collapse"})],-1),as=s("p",null,[l("现在已经准备好证书了. 服务端需要 "),s("code",null,"server.crt"),l(" 和 "),s("code",null,"server.key"),l(", 客户端需要 "),s("code",null,"client.crt"),l(" 和 "),s("code",null,"client.key"),l(". 此外, 两者都需要 "),s("code",null,"ca.crt"),l(".")],-1),ts={id:"实现",tabindex:"-1"},cs={id:"服务端",tabindex:"-1"},rs=s("p",null,"关注高亮行",-1),Fs=s("div",{class:"language-go"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"go"),s("pre",{class:"shiki material-theme-darker has-highlighted-lines vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"package"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"main")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"import"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"crypto/tls"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"crypto/x509"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"net"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"os"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"fmt"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"google.golang.org/grpc"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"google.golang.org/grpc/credentials"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"example/proto"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"func"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"main"),s("span",{style:{color:"#89DDFF"}},"()"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	pair"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"LoadX509KeyPair"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"./server.crt"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"./server.key"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to load certificates: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	certPool "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," x509"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"NewCertPool"),s("span",{style:{color:"#89DDFF"}},"()")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	ca"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," os"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"ReadFile"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"./ca.crt"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#545454","font-style":"italic"}},"// 读取根证书")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to read ca certificate: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," ok "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," certPool"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"AppendCertsFromPEM"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"ca"),s("span",{style:{color:"#89DDFF"}},");"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"!"),s("span",{style:{color:"#EEFFFF"}},"ok "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Println"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to append ca certificate"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	creds "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," credentials"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"NewTLS"),s("span",{style:{color:"#89DDFF"}},"(&"),s("span",{style:{color:"#EEFFFF"}},"tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"Config"),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"		Certificates"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"[]"),s("span",{style:{color:"#EEFFFF"}},"tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"Certificate"),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#EEFFFF"}},"pair"),s("span",{style:{color:"#89DDFF"}},"},")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"		ClientAuth"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}},"   tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"RequireAndVerifyClientCert"),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"		ClientCAs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}},"    certPool"),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"})")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	s "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," grpc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"NewServer"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"grpc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Creds"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"creds"),s("span",{style:{color:"#89DDFF"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	proto"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"RegisterArtworkServiceServer"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"s"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"&"),s("span",{style:{color:"#EEFFFF"}},"server"),s("span",{style:{color:"#89DDFF"}},"{})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	lis"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," net"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Listen"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"tcp"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},":39010"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to listen: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," s"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Serve"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"lis"),s("span",{style:{color:"#89DDFF"}},");"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to serve: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")])])]),s("pre",{class:"shiki github-light has-highlighted-lines vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"package"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"main")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," (")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"crypto/tls"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"crypto/x509"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"net"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"os"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"fmt"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"google.golang.org/grpc"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"google.golang.org/grpc/credentials"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"example/proto"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"func"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"main"),s("span",{style:{color:"#24292E"}},"() {")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	pair, err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," tls."),s("span",{style:{color:"#005CC5"}},"LoadX509KeyPair"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"./server.crt"'),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#032F62"}},'"./server.key"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to load certificates: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	certPool "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," x509."),s("span",{style:{color:"#005CC5"}},"NewCertPool"),s("span",{style:{color:"#24292E"}},"()")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	ca, err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," os."),s("span",{style:{color:"#005CC5"}},"ReadFile"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"./ca.crt"'),s("span",{style:{color:"#24292E"}},") "),s("span",{style:{color:"#6A737D"}},"// 读取根证书")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to read ca certificate: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," ok "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," certPool."),s("span",{style:{color:"#005CC5"}},"AppendCertsFromPEM"),s("span",{style:{color:"#24292E"}},"(ca); "),s("span",{style:{color:"#D73A49"}},"!"),s("span",{style:{color:"#24292E"}},"ok {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Println"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to append ca certificate"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	creds "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," credentials."),s("span",{style:{color:"#005CC5"}},"NewTLS"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#D73A49"}},"&"),s("span",{style:{color:"#24292E"}},"tls.Config{")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"		Certificates: []tls.Certificate{pair},")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"		ClientAuth:   tls.RequireAndVerifyClientCert,")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"		ClientCAs:    certPool,")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	})")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	s "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," grpc."),s("span",{style:{color:"#005CC5"}},"NewServer"),s("span",{style:{color:"#24292E"}},"(grpc."),s("span",{style:{color:"#005CC5"}},"Creds"),s("span",{style:{color:"#24292E"}},"(creds))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	proto."),s("span",{style:{color:"#005CC5"}},"RegisterArtworkServiceServer"),s("span",{style:{color:"#24292E"}},"(s, "),s("span",{style:{color:"#D73A49"}},"&"),s("span",{style:{color:"#24292E"}},"server{})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	lis, err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," net."),s("span",{style:{color:"#005CC5"}},"Listen"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"tcp"'),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#032F62"}},'":39010"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to listen: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        "),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    }")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," s."),s("span",{style:{color:"#005CC5"}},"Serve"),s("span",{style:{color:"#24292E"}},"(lis); err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to serve: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"}")])])]),s("button",{class:"collapse"})],-1),ps={id:"客户端",tabindex:"-1"},ys=s("p",null,"关注高亮行",-1),is=s("div",{class:"language-go"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"go"),s("pre",{class:"shiki material-theme-darker has-highlighted-lines vp-code-dark"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"package"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#FFCB6B"}},"main")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"import"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"crypto/tls"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"crypto/x509"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"os"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"example/proto"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"google.golang.org/grpc"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#FFCB6B"}},"google.golang.org/grpc/credentials"),s("span",{style:{color:"#89DDFF"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"func"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#82AAFF"}},"main"),s("span",{style:{color:"#89DDFF"}},"()"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	pair"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"LoadX509KeyPair"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"./client.crt"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"./client.key"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to load certificates: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	certPool "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," x509"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"NewCertPool"),s("span",{style:{color:"#89DDFF"}},"()")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	ca"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," os"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"ReadFile"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"./ca.crt"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"        fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to read ca certificate: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," ok "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," certPool"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"AppendCertsFromPEM"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"ca"),s("span",{style:{color:"#89DDFF"}},");"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"!"),s("span",{style:{color:"#EEFFFF"}},"ok "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Println"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to append ca certificate"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#EEFFFF"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	cred "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," credentials"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"NewTLS"),s("span",{style:{color:"#89DDFF"}},"(&"),s("span",{style:{color:"#EEFFFF"}},"tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"Config"),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"		Certificates"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"[]"),s("span",{style:{color:"#EEFFFF"}},"tls"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#EEFFFF"}},"Certificate"),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#EEFFFF"}},"pair"),s("span",{style:{color:"#89DDFF"}},"},")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"		ServerName"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}},"   "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"localhost"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#545454","font-style":"italic"}},"// 服务端生成证书时的 commonName")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"		RootCAs"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#EEFFFF"}},"      certPool"),s("span",{style:{color:"#89DDFF"}},",")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"})")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#EEFFFF"}},"	conn"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," grpc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Dial"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"127.0.0.1:39010"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," grpc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"WithTransportCredentials"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"cred"),s("span",{style:{color:"#89DDFF"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#EEFFFF"}}," err "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"nil"),s("span",{style:{color:"#EEFFFF"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		fmt"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Printf"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Failed to dial: "),s("span",{style:{color:"#F07178"}},"%s"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#EEFFFF"}}," err"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"		"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"	"),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"defer"),s("span",{style:{color:"#EEFFFF"}}," conn"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"Close"),s("span",{style:{color:"#89DDFF"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    client "),s("span",{style:{color:"#89DDFF"}},":="),s("span",{style:{color:"#EEFFFF"}}," proto"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"NewArtworkServiceClient"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#EEFFFF"}},"conn"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#EEFFFF"}},"    "),s("span",{style:{color:"#545454","font-style":"italic"}},"// ...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")])])]),s("pre",{class:"shiki github-light has-highlighted-lines vp-code-light"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"package"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"main")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"import"),s("span",{style:{color:"#24292E"}}," (")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"crypto/tls"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"crypto/x509"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"os"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"example/proto"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"google.golang.org/grpc"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#6F42C1"}},"google.golang.org/grpc/credentials"),s("span",{style:{color:"#032F62"}},'"')]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D73A49"}},"func"),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#6F42C1"}},"main"),s("span",{style:{color:"#24292E"}},"() {")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	pair, err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," tls."),s("span",{style:{color:"#005CC5"}},"LoadX509KeyPair"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"./client.crt"'),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#032F62"}},'"./client.key"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to load certificates: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	certPool "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," x509."),s("span",{style:{color:"#005CC5"}},"NewCertPool"),s("span",{style:{color:"#24292E"}},"()")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	ca, err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," os."),s("span",{style:{color:"#005CC5"}},"ReadFile"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"./ca.crt"'),s("span",{style:{color:"#24292E"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"        fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to read ca certificate: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," ok "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," certPool."),s("span",{style:{color:"#005CC5"}},"AppendCertsFromPEM"),s("span",{style:{color:"#24292E"}},"(ca); "),s("span",{style:{color:"#D73A49"}},"!"),s("span",{style:{color:"#24292E"}},"ok {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Println"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to append ca certificate"'),s("span",{style:{color:"#24292E"}},")  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	cred "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," credentials."),s("span",{style:{color:"#005CC5"}},"NewTLS"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#D73A49"}},"&"),s("span",{style:{color:"#24292E"}},"tls.Config{")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"		Certificates: []tls.Certificate{pair},")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"		ServerName:   "),s("span",{style:{color:"#032F62"}},'"localhost"'),s("span",{style:{color:"#24292E"}},", "),s("span",{style:{color:"#6A737D"}},"// 服务端生成证书时的 commonName")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"		RootCAs:      certPool,")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	})")]),l(`
`),s("span",{class:"line highlighted"},[s("span",{style:{color:"#24292E"}},"	conn, err "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," grpc."),s("span",{style:{color:"#005CC5"}},"Dial"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"127.0.0.1:39010"'),s("span",{style:{color:"#24292E"}},", grpc."),s("span",{style:{color:"#005CC5"}},"WithTransportCredentials"),s("span",{style:{color:"#24292E"}},"(cred))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"if"),s("span",{style:{color:"#24292E"}}," err "),s("span",{style:{color:"#D73A49"}},"!="),s("span",{style:{color:"#24292E"}}," "),s("span",{style:{color:"#005CC5"}},"nil"),s("span",{style:{color:"#24292E"}}," {")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		fmt."),s("span",{style:{color:"#005CC5"}},"Printf"),s("span",{style:{color:"#24292E"}},"("),s("span",{style:{color:"#032F62"}},'"Failed to dial: '),s("span",{style:{color:"#005CC5"}},"%s"),s("span",{style:{color:"#032F62"}},'"'),s("span",{style:{color:"#24292E"}},", err)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"		"),s("span",{style:{color:"#D73A49"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"	"),s("span",{style:{color:"#D73A49"}},"defer"),s("span",{style:{color:"#24292E"}}," conn."),s("span",{style:{color:"#005CC5"}},"Close"),s("span",{style:{color:"#24292E"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    client "),s("span",{style:{color:"#D73A49"}},":="),s("span",{style:{color:"#24292E"}}," proto."),s("span",{style:{color:"#005CC5"}},"NewArtworkServiceClient"),s("span",{style:{color:"#24292E"}},"(conn)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"    "),s("span",{style:{color:"#6A737D"}},"// ...")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#24292E"}},"}")])])]),s("button",{class:"collapse"})],-1),Es={id:"参考",tabindex:"-1"};function Ds(e,ds,Cs,hs,r,gs){const a=h,F=p;return d(),D(F,{frontmatter:r.frontmatter,data:r.data},{"main-content-md":o(()=>[s("h2",u,[l("前言 "),t(a,{class:"header-anchor",href:"#前言","aria-label":'Permalink to "前言"'},{default:o(()=>[l("​")]),_:1})]),m,f,A,_,C(" more "),k,s("h2",v,[l("SAN, CA 和证书 "),t(a,{class:"header-anchor",href:"#san-ca-和证书","aria-label":'Permalink to "SAN, CA 和证书"'},{default:o(()=>[l("​")]),_:1})]),N,b,P,B,S,x,L,s("h2",w,[l("生成证书 "),t(a,{class:"header-anchor",href:"#生成证书","aria-label":'Permalink to "生成证书"'},{default:o(()=>[l("​")]),_:1})]),s("h3",R,[l("生成 CA 证书 "),t(a,{class:"header-anchor",href:"#生成-ca-证书","aria-label":'Permalink to "生成 CA 证书"'},{default:o(()=>[l("​")]),_:1})]),T,q,O,$,G,z,J,s("h3",K,[l("生成服务端证书 "),t(a,{class:"header-anchor",href:"#生成服务端证书","aria-label":'Permalink to "生成服务端证书"'},{default:o(()=>[l("​")]),_:1})]),I,V,U,M,j,X,Z,W,Q,s("h3",Y,[l("生成客户端证书 "),t(a,{class:"header-anchor",href:"#生成客户端证书","aria-label":'Permalink to "生成客户端证书"'},{default:o(()=>[l("​")]),_:1})]),H,ss,ls,os,es,ns,as,s("h2",ts,[l("实现 "),t(a,{class:"header-anchor",href:"#实现","aria-label":'Permalink to "实现"'},{default:o(()=>[l("​")]),_:1})]),s("h3",cs,[l("服务端 "),t(a,{class:"header-anchor",href:"#服务端","aria-label":'Permalink to "服务端"'},{default:o(()=>[l("​")]),_:1})]),rs,Fs,s("h3",ps,[l("客户端 "),t(a,{class:"header-anchor",href:"#客户端","aria-label":'Permalink to "客户端"'},{default:o(()=>[l("​")]),_:1})]),ys,is,s("h2",Es,[l("参考 "),t(a,{class:"header-anchor",href:"#参考","aria-label":'Permalink to "参考"'},{default:o(()=>[l("​")]),_:1})]),s("ul",null,[s("li",null,[t(a,{href:"https://grpc.io/docs/guides/auth/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("gRPC Authentication")]),_:1})])])]),"main-header":o(()=>[n(e.$slots,"main-header")]),"main-header-after":o(()=>[n(e.$slots,"main-header-after")]),"main-nav":o(()=>[n(e.$slots,"main-nav")]),"main-content":o(()=>[n(e.$slots,"main-content")]),"main-content-after":o(()=>[n(e.$slots,"main-content-after")]),"main-nav-before":o(()=>[n(e.$slots,"main-nav-before")]),"main-nav-after":o(()=>[n(e.$slots,"main-nav-after")]),comment:o(()=>[n(e.$slots,"comment")]),footer:o(()=>[n(e.$slots,"footer")]),aside:o(()=>[n(e.$slots,"aside")]),"aside-custom":o(()=>[n(e.$slots,"aside-custom")]),default:o(()=>[n(e.$slots,"default")]),_:3},8,["frontmatter","data"])}const Ns=y(g,[["render",Ds]]);export{vs as __pageData,Ns as default};
