import{_ as i}from"./ValaxyMain.vue_vue_type_style_index_0_lang-d2e9213e.js";import{_ as y,c as F,w as o,o as D,b as l,d as s,e as t,a as d,r as a,f as A,p as h}from"./app-a122e0b4.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-11ed27ff.js";import"./YunCard.vue_vue_type_style_index_0_lang-32389446.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-3fa2dcb1.js";const Fs=JSON.parse('{"title":"使用Python写一个Telegram bot吧 | Telegram bot教程","description":"","frontmatter":{"categories":"小技术","date":"2022-12-20T10:22:19.000Z","layout":"post","tags":["Python","telegram","bot","代码"],"title":"使用Python写一个Telegram bot吧 | Telegram bot教程","updated":"2023-02-21T16:13:19.000Z"},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"准备","slug":"准备","link":"#准备","children":[{"level":3,"title":"环境","slug":"环境","link":"#环境","children":[]},{"level":3,"title":"bot 申请","slug":"bot-申请","link":"#bot-申请","children":[]},{"level":3,"title":"获取你的 id","slug":"获取你的-id","link":"#获取你的-id","children":[]}]},{"level":2,"title":"基础","slug":"基础","link":"#基础","children":[{"level":3,"title":"开始:响应/start","slug":"开始-响应-start","link":"#开始-响应-start","children":[]},{"level":3,"title":"功能:授予群成员头衔","slug":"功能-授予群成员头衔","link":"#功能-授予群成员头衔","children":[]},{"level":3,"title":"功能:响应未知命令","slug":"功能-响应未知命令","link":"#功能-响应未知命令","children":[]},{"level":3,"title":"功能:简单的关键词回复","slug":"功能-简单的关键词回复","link":"#功能-简单的关键词回复","children":[]}]},{"level":2,"title":"进阶","slug":"进阶","link":"#进阶","children":[{"level":3,"title":"使用 yml 文件配置","slug":"使用-yml-文件配置","link":"#使用-yml-文件配置","children":[]},{"level":3,"title":"使用 json 存取词库","slug":"使用-json-存取词库","link":"#使用-json-存取词库","children":[]},{"level":3,"title":"定制日志系统","slug":"定制日志系统","link":"#定制日志系统","children":[]},{"level":3,"title":"使用 docker 部署 bot","slug":"使用-docker-部署-bot","link":"#使用-docker-部署-bot","children":[]},{"level":3,"title":"功能:记录睡眠时间","slug":"功能-记录睡眠时间","link":"#功能-记录睡眠时间","children":[]},{"level":3,"title":"功能:mc模组信息查询","slug":"功能-mc模组信息查询","link":"#功能-mc模组信息查询","children":[]}]}],"relativePath":"pages/posts/tg-bot-dev-note-kmua.md","path":"/home/runner/work/blogs-sources/blogs-sources/pages/posts/tg-bot-dev-note-kmua.md","lastUpdated":1677505738000}'),c=JSON.parse('{"title":"使用Python写一个Telegram bot吧 | Telegram bot教程","description":"","frontmatter":{"categories":"小技术","date":"2022-12-20T10:22:19.000Z","layout":"post","tags":["Python","telegram","bot","代码"],"title":"使用Python写一个Telegram bot吧 | Telegram bot教程","updated":"2023-02-21T16:13:19.000Z"},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[]},{"level":2,"title":"准备","slug":"准备","link":"#准备","children":[{"level":3,"title":"环境","slug":"环境","link":"#环境","children":[]},{"level":3,"title":"bot 申请","slug":"bot-申请","link":"#bot-申请","children":[]},{"level":3,"title":"获取你的 id","slug":"获取你的-id","link":"#获取你的-id","children":[]}]},{"level":2,"title":"基础","slug":"基础","link":"#基础","children":[{"level":3,"title":"开始:响应/start","slug":"开始-响应-start","link":"#开始-响应-start","children":[]},{"level":3,"title":"功能:授予群成员头衔","slug":"功能-授予群成员头衔","link":"#功能-授予群成员头衔","children":[]},{"level":3,"title":"功能:响应未知命令","slug":"功能-响应未知命令","link":"#功能-响应未知命令","children":[]},{"level":3,"title":"功能:简单的关键词回复","slug":"功能-简单的关键词回复","link":"#功能-简单的关键词回复","children":[]}]},{"level":2,"title":"进阶","slug":"进阶","link":"#进阶","children":[{"level":3,"title":"使用 yml 文件配置","slug":"使用-yml-文件配置","link":"#使用-yml-文件配置","children":[]},{"level":3,"title":"使用 json 存取词库","slug":"使用-json-存取词库","link":"#使用-json-存取词库","children":[]},{"level":3,"title":"定制日志系统","slug":"定制日志系统","link":"#定制日志系统","children":[]},{"level":3,"title":"使用 docker 部署 bot","slug":"使用-docker-部署-bot","link":"#使用-docker-部署-bot","children":[]},{"level":3,"title":"功能:记录睡眠时间","slug":"功能-记录睡眠时间","link":"#功能-记录睡眠时间","children":[]},{"level":3,"title":"功能:mc模组信息查询","slug":"功能-mc模组信息查询","link":"#功能-mc模组信息查询","children":[]}]}],"relativePath":"pages/posts/tg-bot-dev-note-kmua.md","path":"/home/runner/work/blogs-sources/blogs-sources/pages/posts/tg-bot-dev-note-kmua.md","lastUpdated":1677505738000}'),_={name:"pages/posts/tg-bot-dev-note-kmua.md",data(){return{data:c,frontmatter:c.frontmatter}},setup(){h("pageData",c)}},u={id:"前言",tabindex:"-1"},C=l("p",null,[l("s",null,"为了激发群友们水群的积极性，"),s(" 为了学习和应用 python 知识，我最近在开发一个 telegram 的 bot，所以写这篇文章以记录和分享")],-1),m=l("p",null,"本文不是从零开始的教程，阅读本文前，你需要具有一点点(真的很少一点)的 python 或其他语言编程的基础。",-1),f={id:"准备",tabindex:"-1"},g={id:"环境",tabindex:"-1"},b=l("p",null,"使用你喜欢的工具创建虚拟环境，并安装以下 Python 库",-1),k=l("div",{class:"language-yaml"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C3E88D"}},"PyYAML")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C3E88D"}},"telegram")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C3E88D"}},"python-telegram-bot")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C3E88D"}},"pypinyin")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C3E88D"}},"parsel")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C3E88D"}},"pyppeteer")]),s(`
`),l("span",{class:"line"})])])],-1),x=l("li",null,"telegram: 基础的telegram包",-1),v=l("li",null,"python-telegram-bot==20.0a6: 一个对 Telegram bot api 封装的 python 库，注意版本，默认安装的是 13.14 ，要手动指定版本安装最新开发版本（截止写稿是 20.0a6 ），以支持异步特性。",-1),E=l("blockquote",null,[l("p",null,"更新: 2023-02-21: python-telegram-bot 已经默认安装最新版本了，不需要手动指定版本了")],-1),T=l("li",null,"pypinyin: 汉语拼音相关",-1),w=l("li",null,"parsel: 数据解析",-1),P={id:"bot-申请",tabindex:"-1"},$=l("code",null,"/newbot",-1),H=l("strong",null,"API Token",-1),M={id:"获取你的-id",tabindex:"-1"},N=l("strong",null,"user_id",-1),O={id:"基础",tabindex:"-1"},U=l("hr",null,null,-1),B={id:"开始-响应-start",tabindex:"-1"},j=l("p",null,[s("在项目文件夹内，新建 "),l("code",null,"bot.py"),s("，开始编写 bot 最基础的功能，让其响应 /start 命令")],-1),Y=l("p",null,"首先，导入包（先不要管它们都是什么鬼东西）",-1),L=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"# Update:从Telegram获取更新")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),l("span",{style:{color:"#A6ACCD"}}," telegram "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),l("span",{style:{color:"#A6ACCD"}}," Update")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"#ApplicationBuilder:简单立即为构建 bot 对象")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"#ContextTypes:上下文类型")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"#CommandHandler:命令处理器")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),l("span",{style:{color:"#A6ACCD"}}," telegram"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#A6ACCD"}},"ext "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),l("span",{style:{color:"#A6ACCD"}}," ApplicationBuilder"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," ContextTypes"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," CommandHandler")]),s(`
`),l("span",{class:"line"})])])],-1),R=l("p",null,"然后，写一个异步函数 start()，当收到 /start 命令时，要调用它。",-1),S=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"async"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"def"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"start"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"update"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," Update"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"context"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," ContextTypes"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"DEFAULT_TYPE"),l("span",{style:{color:"#89DDFF"}},"):")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"'''"),l("span",{style:{color:"#676E95","font-style":"italic"}},"响应start命令"),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"'''")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    text "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"你好~我是一个bot"),l("span",{style:{color:"#89DDFF"}},"'")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"send_message"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_chat"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"text"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"text"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),K=l("p",null,[s("这个函数接受两个参数 "),l("code",null,"update"),s(" 和 "),l("code",null,"context"),s("，形参冒号后是类型注解。这两个参数 "),l("code",null,"CommandHandler"),s(" 会传递给它。")],-1),V=l("p",null,[l("code",null,"context.bot.send_message()"),s(" 方法即为让 bot 发送消息，它能接受的参数其实很多，但是往往只需要 "),l("code",null,"chat_id"),s(" ，和 "),l("code",null,"text"),s(" 就够了，它们分别表示 要发送消息给的用户或群组 id ，要发送的文本。")],-1),Z=l("p",null,[s("而 "),l("code",null,"update.effective_chat.id"),s(" 即为当前有效对话的 id ，在哪里发消息给 bot ，它就指向哪里的 id。")],-1),q=l("p",null,"现在，添加一个处理器(handler)",-1),G=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"start_handler "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"CommandHandler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"start"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," start"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),I=l("p",null,[l("code",null,"CommandHandler"),s(" 类可以实现当收到某个命令时，调用某个函数（命令和函数名可以不一样），我们将其实例化为了 "),l("code",null,"start_handler"),s(" ，并且将命令名字 'start' 和对应要回调的函数名 start 传递给它")],-1),J=l("p",null,"然后，启动bot",-1),X=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"# 构建 bot")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"TOEKN"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"你 bot 的 api token"),l("span",{style:{color:"#89DDFF"}},"'")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"ApplicationBuilder"),l("span",{style:{color:"#89DDFF"}},"()."),l("span",{style:{color:"#82AAFF"}},"token"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"TOKEN"),l("span",{style:{color:"#89DDFF"}},")."),l("span",{style:{color:"#82AAFF"}},"build"),l("span",{style:{color:"#89DDFF"}},"()")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"# 注册 handler")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"add_handler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"start_handler"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#676E95","font-style":"italic"}},"# run!")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"run_polling"),l("span",{style:{color:"#89DDFF"}},"()")]),s(`
`),l("span",{class:"line"})])])],-1),z=l("p",null,[s("最后，就可以使用 "),l("code",null,"python bot.py"),s(" 启动你的 bot ，对 bot 发送 /start ，它应该就会回复你 ”你好~我是一个bot”。 使用 Ctrl + C 结束程序运行。")],-1),W=l("p",null,"到这里，其实你已经了解到了最基本的 telegram bot 编写规则，即：",-1),Q=l("ol",null,[l("li",null,[s("编写回调函数。上面的例子中即为 "),l("code",null,"start"),s(" 这个函数。")]),l("li",null,[s("决定调用回调函数的规则。上述例子中，即为收到 "),l("code",null,"/start"),s(" 命令时，调用 "),l("code",null,"start"),s(" 函数")]),l("li",null,[s("实例化 "),l("code",null,"handler"),s(" ,注册给 "),l("code",null,"application"),s(" 示例。上述例子中，即为 "),l("code",null,"application.add_handler(start_handler)")])],-1),ll=l("p",null,"如果你的系统无法访问 Telegram 的服务器，可以设置代理",-1),sl=l("p",null,"全局代理,整个程序都走代理:",-1),ol=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"os"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"environ"),l("span",{style:{color:"#89DDFF"}},"["),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"http_proxy"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},"]"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"代理地址"),l("span",{style:{color:"#89DDFF"}},"'")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"os"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"environ"),l("span",{style:{color:"#89DDFF"}},"["),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"https_proxy"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},"]"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"代理地址"),l("span",{style:{color:"#89DDFF"}},"'")]),s(`
`),l("span",{class:"line"})])])],-1),el=l("p",null,"若想仅为 telegram bot api 设置代理,则需要改动一下构建 bot 部分的代码:",-1),tl=l("p",null,"http(s)代理:",-1),nl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"proxy_url "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"http://USERNAME:PASSWORD@PROXY_HOST:PROXY_PORT"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#A6ACCD"}},"  "),l("span",{style:{color:"#676E95","font-style":"italic"}},"# can also be a https proxy")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"ApplicationBuilder"),l("span",{style:{color:"#89DDFF"}},"()."),l("span",{style:{color:"#82AAFF"}},"token"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#C3E88D"}},"TOKEN"),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#89DDFF"}},")."),l("span",{style:{color:"#82AAFF"}},"proxy_url"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"proxy_url"),l("span",{style:{color:"#89DDFF"}},")."),l("span",{style:{color:"#82AAFF"}},"get_updates_proxy_url"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"proxy_url"),l("span",{style:{color:"#89DDFF"}},")."),l("span",{style:{color:"#82AAFF"}},"build"),l("span",{style:{color:"#89DDFF"}},"()")]),s(`
`),l("span",{class:"line"})])])],-1),al=l("p",null,[s("socks5代理,需要安装 "),l("code",null,"python-telegram-bot[socks]"),s(",然后:")],-1),cl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"proxy_url "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#C3E88D"}},"socks5://user:pass@host:port"),l("span",{style:{color:"#89DDFF"}},'"')]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"ApplicationBuilder"),l("span",{style:{color:"#89DDFF"}},"()."),l("span",{style:{color:"#82AAFF"}},"token"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#C3E88D"}},"TOKEN"),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#89DDFF"}},")."),l("span",{style:{color:"#82AAFF"}},"proxy_url"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"proxy_url"),l("span",{style:{color:"#89DDFF"}},")."),l("span",{style:{color:"#82AAFF"}},"build"),l("span",{style:{color:"#89DDFF"}},"()")]),s(`
`),l("span",{class:"line"})])])],-1),rl=l("p",null,"接下来，写一些更有趣的功能，使用更复杂一些的规则来调用这些功能。",-1),pl={id:"功能-授予群成员头衔",tabindex:"-1"},il=l("p",null,[s("让群成员可以通过 bot 自助获得一个头衔吧，比如，群友可以在群里使用 "),l("code",null,"/p@botname 好人"),s(" 来给自己加上 “好人” 的头衔。")],-1),yl=l("p",null,"当然，前提是 bot 自己要是管理员，并且权限全开。",-1),Fl=l("p",null,"要实现这个功能，可以这样写:",-1),Dl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"async"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"def"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"set_right"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"update"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," Update"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"context"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," ContextTypes"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"DEFAULT_TYPE"),l("span",{style:{color:"#89DDFF"}},"):")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"'''"),l("span",{style:{color:"#676E95","font-style":"italic"}},"设置成员权限和头衔"),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"'''")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    chat_id "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_chat"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"id")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    user_id "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_user"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"id")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    bot_username_len "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"len"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"_bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"name"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    custom_title "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_message"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"text"),l("span",{style:{color:"#89DDFF"}},"["),l("span",{style:{color:"#F78C6C"}},"3"),l("span",{style:{color:"#89DDFF"}},"+"),l("span",{style:{color:"#F07178"}},"bot_username_len"),l("span",{style:{color:"#89DDFF"}},":]")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"not"),l("span",{style:{color:"#A6ACCD"}}," custom_title"),l("span",{style:{color:"#89DDFF"}},":")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"        custom_title "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_user"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"username")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"try"),l("span",{style:{color:"#89DDFF"}},":")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"        "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"promote_chat_member"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"user_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"user_id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"can_manage_chat"),l("span",{style:{color:"#89DDFF"}},"=True)")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"        "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"set_chat_administrator_custom_title"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"user_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"user_id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"custom_title"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"custom_title"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"        text "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"f"),l("span",{style:{color:"#C3E88D"}},"'好,你现在是"),l("span",{style:{color:"#F78C6C"}},"{"),l("span",{style:{color:"#A6ACCD"}},"custom_title"),l("span",{style:{color:"#F78C6C"}},"}"),l("span",{style:{color:"#C3E88D"}},"啦'")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"        "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"send_message"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"reply_to_message_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_message"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"text"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"text"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"except"),l("span",{style:{color:"#89DDFF"}},":")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"        "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"send_message"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"text"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"不行!!"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),dl=l("p",null,"然后，添加这个功能的handler:",-1),Al=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"set_right_handler "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"CommandHandler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"p"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," set_right"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"add_handler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"set_right_handler"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),hl=l("p",null,[s("注意handler的添加应该在 "),l("code",null,"application.run_polling()"),s(" 之前，也就是说 "),l("code",null,"application.run_polling()"),s(" 才是真正开始运行 bot")],-1),_l=l("p",null,[s("简单解释一下 "),l("code",null,"set_right"),s(" 这个函数:")],-1),ul=l("p",null,[s("首先，设置了调用这个函数时的 "),l("code",null,"chat_id"),s(" 和 "),l("code",null,"user_id"),s(" 为当前聊天和当前用户")],-1),Cl=l("p",null,[s("然后用 "),l("code",null,"len(update._bot.name)"),s(" 获取 bot 自己用户名的长度，用于下面的切片选取用户想要的头衔")],-1),ml=l("p",null,[s("而 "),l("code",null,"custom_title = update.effective_message.text[3+bot_username_len:]"),s(" 即获取用户想要的头衔，存储在 "),l("code",null,"custom_title"),s(" 中，下面的 if not 的作用是，如果用户没有发送他想要的头衔，那么默认头衔为他的用户名")],-1),fl=l("p",null,"由于只有管理员才有头衔，所以我们使用 promote_chat_member() 方法设置成员权限，将其的 can_manage_chat 权限设置为 True 。注意，即使这样设置了，用户实则是有名无权的状态，只有一个管理员的名头，实际上没有任何权限。",-1),gl=l("blockquote",null,[l("p",null,"要想赋予权限，你可以向 promote_chat_member() 方法中继续添加参数，如 can_pin_messages=True 可置顶消息")],-1),bl=l("p",null,"然后就可以使用 set_chat_administrator_custom_title() 方法设置成员头衔了，如果成功了，会继续执行接下来的语句，将结果反馈给用户。",-1),kl={id:"功能-响应未知命令",tabindex:"-1"},xl=l("p",null,"如果 bot 只能回应设置好的命令就太无趣了，所以再编写一个当收到未知命令时的执行功能 比如，想要让 bot 回应未知命令说 “我不会这个哦~”，可以这样写",-1),vl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"async"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"def"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"unknown"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"update"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," Update"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"context"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," ContextTypes"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"DEFAULT_TYPE"),l("span",{style:{color:"#89DDFF"}},"):")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"'''"),l("span",{style:{color:"#676E95","font-style":"italic"}},"响应未知命令"),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"'''")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    logger"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"debug"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"调用:unknown"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    text "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},'"'),l("span",{style:{color:"#C3E88D"}},"我不会这个哦~"),l("span",{style:{color:"#89DDFF"}},'"')]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"send_message"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_chat"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"text"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"text"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),El=l("p",null,[s("然后，添加它的 "),l("code",null,"handler"),s("。这时候可能就出现问题： 前面的两个功能都是回应一个特定的命令，在这里，我们希望它回应除已经设定的命令外的其他所有命令，该怎么做？")],-1),Tl=l("p",null,[s("这就需要用到 "),l("code",null,"filters"),s(" ，并且要"),l("strong",null,"设置功能的优先级"),s(" 你需要先导入它")],-1),wl=l("p",null,[l("code",null,"from telegram.ext import filters")],-1),Pl=l("p",null,"然后可以这样写:",-1),$l=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"unknown_handler "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"MessageHandler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"filters"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"COMMAND"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," unknown"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),Hl=l("p",null,[l("code",null,"filters"),s(" 即过滤器，而 "),l("code",null,"filters.COMMAND"),s(" 即为所有命令。而设置优先级其实非常简单，"),l("strong",null,[s("添加 "),l("code",null,"handler"),s(" 的顺序越靠后，对应功能的优先级越低")])],-1),Ml=l("p",null,[s("也就是说，我们需要在其他命令类 "),l("code",null,"handler"),s(" 之后，添加 "),l("code",null,"unknown_handler")],-1),Nl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"add_handler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"start_handler"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"add_handler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"set_right_handler"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"add_handler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"unkonw_handler"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"run_polling"),l("span",{style:{color:"#89DDFF"}},"()")]),s(`
`),l("span",{class:"line"})])])],-1),Ol={id:"功能-简单的关键词回复",tabindex:"-1"},Ul=l("p",null,[s("bot 最常见的功能之一就是根据关键词回复特定内容，比如，当对 bot 说早安之类的话时，让 bot 对此做出回应。下面来实现这这一功能 由于命令和普通消息是两种不同的消息类，处理它们的方法是不一样的，针对非命令消息，要使用 "),l("code",null,"MessageHandler"),s(": "),l("code",null,"from telegram.ext import MessageHandler")],-1),Bl=l("p",null,"首先还是要编写这个功能执行的函数。",-1),jl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),l("span",{style:{color:"#A6ACCD"}}," random")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#C792EA"}},"async"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#C792EA"}},"def"),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"ohayo"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"update"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," Update"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"context"),l("span",{style:{color:"#89DDFF"}},":"),l("span",{style:{color:"#A6ACCD"}}," ContextTypes"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"DEFAULT_TYPE"),l("span",{style:{color:"#89DDFF"}},"):")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    texts "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#89DDFF"}},"["),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"早上好呀"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"我的小鱼你醒了，还记得清晨吗"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"哦哈哟~"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},"]")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"    "),l("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),l("span",{style:{color:"#A6ACCD"}}," context"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"bot"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"send_message"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"chat_id"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"update"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"effective_chat"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#F07178"}},"id"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," "),l("span",{style:{color:"#A6ACCD","font-style":"italic"}},"text"),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#82AAFF"}},"random"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"choice"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"text"),l("span",{style:{color:"#89DDFF"}},"))")]),s(`
`),l("span",{class:"line"})])])],-1),Yl=l("p",null,[s("由于只回复一个固定的消息过于单调，所以我们使用 "),l("code",null,"random"),s(" 库来从一个列表中随机选择一个回复")],-1),Ll=l("p",null,[s("实际上，这个函数仍然只是简单的发送消息，而何时调用这个函数，并不是这个函数本身要做的事，而是由接下来我们要编写的 "),l("code",null,"MessageHandler"),s(" 中的 "),l("code",null,"filters"),s(" 决定的:")],-1),Rl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"filter_ohayo "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," filters"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"Regex"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#C3E88D"}},"早安|早上好|哦哈哟|ohayo"),l("span",{style:{color:"#89DDFF"}},"'"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"ohayo_handler "),l("span",{style:{color:"#89DDFF"}},"="),l("span",{style:{color:"#A6ACCD"}}," "),l("span",{style:{color:"#82AAFF"}},"MessageHandler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"filter_ohayo"),l("span",{style:{color:"#89DDFF"}},","),l("span",{style:{color:"#82AAFF"}}," ohayo"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),Sl=l("p",null,[l("code",null,"filters.Regex()"),s(" 即为使用正则表达式过滤，我们使用 "),l("code",null,"'早安|早上好|哦哈哟|ohayo'"),s(" 这个表达式，很容易理解何时会调用 "),l("code",null,"ohayo"),s(" 这个函数")],-1),Kl=l("p",null,[s("记得添加它的 "),l("code",null,"handler")],-1),Vl=l("div",{class:"language-python"},[l("span",{class:"copy"}),l("pre",{class:"shiki material-theme-palenight",tabindex:"0"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#A6ACCD"}},"application"),l("span",{style:{color:"#89DDFF"}},"."),l("span",{style:{color:"#82AAFF"}},"add_handler"),l("span",{style:{color:"#89DDFF"}},"("),l("span",{style:{color:"#82AAFF"}},"ohayo_handler"),l("span",{style:{color:"#89DDFF"}},")")]),s(`
`),l("span",{class:"line"})])])],-1),Zl={id:"进阶",tabindex:"-1"},ql=l("hr",null,null,-1),Gl=l("p",null,"未完待续",-1),Il={id:"使用-yml-文件配置",tabindex:"-1"},Jl={id:"使用-json-存取词库",tabindex:"-1"},Xl={id:"定制日志系统",tabindex:"-1"},zl={id:"使用-docker-部署-bot",tabindex:"-1"},Wl={id:"本地构建",tabindex:"-1"},Ql={id:"使用-github-action-自动构建",tabindex:"-1"},ls={id:"功能-记录睡眠时间",tabindex:"-1"},ss={id:"功能-mc模组信息查询",tabindex:"-1"};function os(n,es,ts,ns,r,as){const e=A,p=i;return D(),F(p,{frontmatter:r.frontmatter,data:r.data},{"main-content-md":o(()=>[l("h2",u,[s("前言 "),t(e,{class:"header-anchor",href:"#前言","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),C,l("p",null,[s("在这篇文章中，将使用 "),t(e,{href:"https://docs.python-telegram-bot.org",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("Python-Telegram-Bot")]),_:1}),s(" 最新版库，基于 Python 的新版异步特性与 Telegram 友好开放的 API，开发一个兼顾实用性和趣味的 bot ，并使用 Docker 在任何地方部署 bot")]),l("p",null,[s("我写的 bot 的 GitHub 仓库: "),t(e,{href:"https://github.com/krau/kmua-bot",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("kmua-bot")]),_:1}),s("，欢迎大佬批评。")]),m,d(" more "),l("h2",f,[s("准备 "),t(e,{class:"header-anchor",href:"#准备","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h3",g,[s("环境 "),t(e,{class:"header-anchor",href:"#环境","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),b,k,l("ul",null,[l("li",null,[s("PyYAML: "),t(e,{href:"https://zh.wikipedia.org/wiki/YAML",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("yaml")]),_:1}),s(" 配置文件相关包")]),x,v]),E,l("ul",null,[T,w,l("li",null,[s("pyppeteer: 浏览器爬虫包，"),t(e,{href:"https://github.com/puppeteer/puppeteer",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("puppeteer")]),_:1}),s(" 的 python 移植（问我为啥不用更好的 "),t(e,{href:"https://github.com/microsoft/playwright-python",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("playwright-python")]),_:1}),s(" ？被简中互联网上的文章坑了，以后会迁移过去。）")])]),l("h3",P,[s("bot 申请 "),t(e,{class:"header-anchor",href:"#bot-申请","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("p",null,[s("私聊 "),t(e,{href:"https://t.me/BotFather",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("@BotFather")]),_:1}),s("。发送 "),$,s("，根据提示一步步创建，记得妥善保存最后的 "),H,s("。")]),l("h3",M,[s("获取你的 id "),t(e,{class:"header-anchor",href:"#获取你的-id","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("p",null,[s("每个 tg 用户都有一串标识数字，即为 "),N,s("，可以私聊 "),t(e,{href:"https://t.me/userinfobot",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("@userinfobot")]),_:1}),s(" 来获取它")]),l("h2",O,[s("基础 "),t(e,{class:"header-anchor",href:"#基础","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),U,l("h3",B,[s("开始:响应/start "),t(e,{class:"header-anchor",href:"#开始-响应-start","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),j,Y,L,R,S,K,V,Z,l("blockquote",null,[l("p",null,[s("你注意到 这个函数使用了 async/await 语法，这是 python 新版的语法糖，详见 官方文档 "),t(e,{href:"https://docs.python.org/3/library/asyncio.html",target:"_blank",rel:"noreferrer"},{default:o(()=>[s("asyncio")]),_:1})])]),q,G,I,J,X,z,W,Q,ll,sl,ol,el,tl,nl,al,cl,rl,l("h3",pl,[s("功能:授予群成员头衔 "),t(e,{class:"header-anchor",href:"#功能-授予群成员头衔","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),il,yl,Fl,Dl,dl,Al,hl,_l,ul,Cl,ml,fl,gl,bl,l("h3",kl,[s("功能:响应未知命令 "),t(e,{class:"header-anchor",href:"#功能-响应未知命令","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),xl,vl,El,Tl,wl,Pl,$l,Hl,Ml,Nl,l("h3",Ol,[s("功能:简单的关键词回复 "),t(e,{class:"header-anchor",href:"#功能-简单的关键词回复","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),Ul,Bl,jl,Yl,Ll,Rl,Sl,Kl,Vl,l("h2",Zl,[s("进阶 "),t(e,{class:"header-anchor",href:"#进阶","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),ql,Gl,l("h3",Il,[s("使用 yml 文件配置 "),t(e,{class:"header-anchor",href:"#使用-yml-文件配置","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h3",Jl,[s("使用 json 存取词库 "),t(e,{class:"header-anchor",href:"#使用-json-存取词库","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h3",Xl,[s("定制日志系统 "),t(e,{class:"header-anchor",href:"#定制日志系统","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h3",zl,[s("使用 docker 部署 bot "),t(e,{class:"header-anchor",href:"#使用-docker-部署-bot","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h4",Wl,[s("本地构建 "),t(e,{class:"header-anchor",href:"#本地构建","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h4",Ql,[s("使用 GitHub action 自动构建 "),t(e,{class:"header-anchor",href:"#使用-github-action-自动构建","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h3",ls,[s("功能:记录睡眠时间 "),t(e,{class:"header-anchor",href:"#功能-记录睡眠时间","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})]),l("h3",ss,[s("功能:mc模组信息查询 "),t(e,{class:"header-anchor",href:"#功能-mc模组信息查询","aria-hidden":"true"},{default:o(()=>[s("#")]),_:1})])]),"main-header":o(()=>[a(n.$slots,"main-header")]),"main-header-after":o(()=>[a(n.$slots,"main-header-after")]),"main-nav":o(()=>[a(n.$slots,"main-nav")]),"main-content":o(()=>[a(n.$slots,"main-content")]),"main-content-after":o(()=>[a(n.$slots,"main-content-after")]),"main-nav-before":o(()=>[a(n.$slots,"main-nav-before")]),"main-nav-after":o(()=>[a(n.$slots,"main-nav-after")]),comment:o(()=>[a(n.$slots,"comment")]),footer:o(()=>[a(n.$slots,"footer")]),aside:o(()=>[a(n.$slots,"aside")]),"aside-custom":o(()=>[a(n.$slots,"aside-custom")]),default:o(()=>[a(n.$slots,"default")]),_:3},8,["frontmatter","data"])}const Ds=y(_,[["render",os]]);export{Fs as __pageData,Ds as default};
